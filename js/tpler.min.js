!function(t,e){if("function"==typeof define&&define.amd)define("tpler",[],e);else if("object"==typeof module&&module.exports)module.exports=e();else if(t)t.tpler=e();else{e()}}(this,function(){function template(t){return new template.prototype.init(t)}var reg_tpl_tag=/{=(.*?)(?:\|(.*?))?}/g,reg_operation_symbol=/[\+|\-|\*|\/|\(|\)]+/g,rootEl,$index=1,$length=1,toucher,customFilters={},customSyntax="",customMethods={},customDirectives={},templateConfig={},SYNTAX="syntax",GROUP="group",LAZY="lazy",MORE="more",DEFAULT="default",DATA="data",PAGESIZE="pagesize",KEYWORD="keyword",TEMPLATE="template",NOLOOP="noloop",LOOP="loop",MODEL="model",TAP="tap",LONGTAP="longtap",DRAG="drag",ON="on",BIND="bind",inBrowser="undefined"!=typeof window;console.log("before inBrowser:"+inBrowser);var isSupportTouch=!!inBrowser&&function(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}(),extend=function(t){var e=arguments.length;e>1&&(t=t||{});for(var r=1;r<e;r++){var n=arguments[r];if(n)for(var i in n)t[i]=n[i]}return t},extendOwn=function(t){var e=arguments.length;e>1&&(t=t||{});for(var r=1;r<e;r++){var n=arguments[r];if(n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},screen={x:100,y:100},envt;if(inBrowser){var ua=window.navigator.userAgent.toLowerCase(),isIE=/msie|trident/.test(ua),isIE9=!!~ua.indexOf("msie 9.0"),isEdge=!!~ua.indexOf("edge/"),isChrome=/chrome\/\d+/.test(ua)&&!isEdge,weixin=/MicroMessenger/i.test(ua),isWxMiniProgram=/miniprogram/i.test(window.__wxjs_environment),env=function(){var t={},e=ua.match(/(Android)[\s\/]+([\d\.]+)/),r=ua.match(/(iPad|iPhone|iPod)\s+OS\s([\d_\.]+)/),n=(ua.match(/(Windows\s+Phone)\s([\d\.]+)/),/WebKit\/[\d.]+/i.test(ua)),i=!!r&&(navigator.standalone?n:/Safari/i.test(ua)&&!/CriOS/i.test(ua)&&!/MQQBrowser/i.test(ua));return e&&(t.isAndroid=!0,t.android=!0,t.version=e[2]),r&&(t.isIOS=!0,t.ios=!0,t.version=r[2].replace(/_/g,"."),t.ios7=/^7/.test(t.version),t.ios11=/^11/.test(t.version),"iPad"===r[1]?t.ipad=!0:"iPhone"===r[1]?t.iphone=!0:"iPod"===r[1]&&(t.ipod=!0)),n&&(t.webkit=!0),i&&(t.safari=!0),t}();envt=extend(env,{inBrowser:inBrowser,ua:ua,isIE:isIE,isIE9:isIE9,isEdge:isEdge,isChrome:isChrome,weixin:weixin,isWxMiniProgram:isWxMiniProgram}),screen={x:document.documentElement.clientWidth,y:document.documentElement.clientHeight}}var _={envt:envt,extend:extend,extendOwn:extendOwn,screen:screen,type:function(t){if(null===t)return"null";var e=Object.prototype.toString.call(t),r=e.match(/\[object (.*?)\]/)[1].toLowerCase();return"number"===r?isNaN(t)?"nan":isFinite(t)?r:"infinity":r},isElement:function(t){return/html.*?element/i.test(this.type(t))},isDocument:function(t){return/document/i.test(this.type(t))},objectName:function(t){return _.isUndefined(t)?_.isUndefined(t):_.isNull(t)?_.isNull(t):t.prototype.constructor?t.prototype.constructor.name:t.__proto__.constructor.name},has:function(t,e){if(_.isObject(t)){if(_.isNumber(+e))return t.hasOwnProperty(""+e);for(var r=e.split("."),n=t;e=r.shift();){if(!n||!n.hasOwnProperty(e))return!1;n=n[e]}return!0}return!(!_.isArray(t)&&!_.isString(t))&&!!~t.indexOf(e)},isJQuery:function(t){return!!t&&!!t.jquery},keys:function(t){if(!_.isObject(t))return[];if(Object.keys)return Object.keys(t);var e=[];for(var r in t)t.hasOwnProperty(r)&&(e[e.length]=r);return e},equal:function(t,e){if(t===e)return!0;if(_.isArray(t)&&_.isArray(e))return t.toString()===e.toString();if(_.isObject(t)&&_.isObject(e)){if(_.keys(t).length!==_.keys(e).length)return!1;for(var r in t)if(!_.equal(t[r],e[r]))return!1;return!0}return _.type(t)===_.type(e)&&t===e},text:function(t){if(_.isElement(t))return t.innerText},html:function(t){if(_.isElement(t))return t.innerHTML},fast:function(){for(var t=arguments.length,e=new Array(t),r=1e4;t--;)e[t]=arguments[t];var n=e[e.length-1];_.isNumber(n)&&(r=n,e.pop());var i=function(t,r){var n="run "+t.name+"{} "+r+" time"+(r>1?"s":"");for(console.time(n);r--;)t.apply(this,e);console.timeEnd(n)};e.forEach(function(t){t&&i.call(this,t,r)})},pos:function(t,e){function r(t,e,r){_.isDocument(r)&&(r=document.doctype?window.document.documentElement:document.body),this.x=t,this.y=e,this.time=+new Date,this.el=r,this.width=r.clientWidth,this.height=r.clientHeight,this.scrollTop=r.scrollTop,this.scrollHeight=r.scrollHeight,this.offsetHeight=r.offsetHeight,this.top=e,this.left=t,this.right=t+this.width,this.bottom=e+this.height}function n(t){for(var e=new r(t.offsetLeft,t.offsetTop,t),n=t.offsetParent;n;)e.x+=n.offsetLeft,e.y+=n.offsetTop,n=n.offsetParent;return i&&(e.x-=i.x,e.y-=i.y),e}var i;if(_.isElement(e)||_.isTouchEvent(t)||_.isMouseEvent(t)?i=_.pos(e):_.isObject(e)&&"Postion"===_.objectName(e)&&(i=e),_.isElement(t)){var o=t;return n(o)}if(_.isTouchEvent(t)||_.isMouseEvent(t)){var a,s,c=t,o=c.currentTarget,h=c.touches&&c.touches.length>0?c.touches:c.changedTouches;if(h&&0!==h.length){var u=h[0];a=u.pageX,s=u.pageY}else a=c.clientX,s=c.clientY;return i&&(a-=i.x,s-=i.y),new r(a,s,o)}if(_.isString(t))return _.pos(_.query(t))},drag:function(t){toucher({el:t,type:"drag"})},parseUrl:function(t){var e,r,n,i={},o=location.hash,a=o,t=t||window.location.href;t.replace(/http[s]?:\/\/([^:]*?)(?::(\d+))?\//,function(t,i,o){e=t.substring(0,t.length-1),r=i,n=o});var s=function(){var e=t.match(/#(.*)$/);return e?e[1]:""},c=function(t){return decodeURI(t.replace(/%25/g,"%2525"))},h=function(){var t=location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},u=function(){var t=c(location.pathname+h()).slice(0);return"/"===t.charAt(0)?t.slice(1):t},l=u();return o=s(),t.replace(/[?&](.+?)=([^&#]*)/g,function(_,t,e){i[t]=decodeURI(e)}),o&&(o=o.length>1?o.replace(/#+/g,"#"):"",a=o.replace(/#/g,"")),{params:i,hash:o,route:a,path:l,domain:e,host:r,port:n}},guid:1,uId:function(){return Math.random().toString(16).slice(2)},random:function(t,e,r){if(_.isArray(t))return t[Math.random()*t.length<<0];if(_.isNumber(t))return Math.random()*t<<0;for(var n=r||"_",e=e||6,t=t||"abcdefghijklmnopqrstuvwxyz",i=0;i<e;i++)n+=t.charAt(Math.random()*t.length<<0);return n},between:function(t,e,r){var n=arguments.length;if(3===n)return _.min(e,_.max(t,r));if(1===n)return t*Math.random()<<0;if(String(t).indexOf(".")===-1)return t+(e-t+1)*Math.random()<<0;var i=String(t).split(".")[1].length;return+(t+(e-t)*Math.random()).toFixed(i)},grpstats:function(t){var e={};return t.forEach(function(t){_.has(e,t)?e[t]+=1:e[t]=1}),e},autoid:function(t,e){var r=function(t){return _.isDocument(t)?t:(_.isElement(t)&&(e?t.setAttribute("id",_.random()):_.isEmpty(t.id)&&t.setAttribute("id",_.random())),t)};return _.isArray(t)?t.map(function(t){return r(t)}):r(t)},jqToEl:function(t,e){if(_.isJQuery(t)){var r=[];return t.each(function(t,n){e?r[r.length]=e(n):r[r.length]=n}),1===r.length?r[0]:r}},query:function(t){for(var e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];if(r.length>1&&(t=""+r),_.isWindow(t)||_.isDocument(t))return t;if(_.isFunction(t))return t(),[];var n=function(t){if(_.isElement(this)&&(_.autoid(this),this.id)){var e=t.split(","),r="#"+this.id;t=r+e.join(","+r)+","+r+" "+e.join(","+r+" ")}return t};if(_.isElement(t)){if(_.autoid(t),!_.isElement(this))return t;t="#"+t.id,t=n.call(this,t)}else{if(_.isArray(t))return t.map(function(t){return _.query(t)});if(_.isJQuery(t))return _.jqToEl(t);t=n.call(this,t)}try{var i=document.querySelectorAll(t),r=Array.prototype.slice.call(i),e=r.length;return 0===e?[]:1===e?_.autoid(r[0]):_.autoid(r)}catch(o){console.log(o);var a=t.split(":");return a.length>1?_.query(a[0]).filter(a[1]):[]}},json:function(str){if(_.isEmpty(str))return{};try{return JSON.parse(str)}catch(e1){console.log(e1);try{return eval("("+str+")")}catch(e2){return console.log(e2),e2}}},capitalize:function(t){var e=Array.prototype.slice.call(arguments),r=e.length;return r>1?_.capitalize.call(this,e):_.isArray(t)?t.map(function(t){return _.capitalize(t)}):(t=""+t,t.substring(0,1).toUpperCase()+t.substring(1))},camelCase:function(t){var e=Array.prototype.slice.call(arguments),r=e.length;return r>1?e[0]+_.capitalize(e.slice(1)).join(""):_.isArray(t)?t[0]+_.capitalize(t.slice(1)).join(""):e[0]},camel2underscode:function(t){return t.match(/^[a-z][a-z0-9]+|[A-Z][a-z0-9]*/g).join("_").toLowerCase()},copy:function(t,e){const r=document.createRange();r.selectNode(t);const n=window.getSelection();n.rangeCount>0&&n.removeAllRanges(),n.addRange(r);try{document.execCommand("copy",e||!1,null)?console.log("copy ok"):console.log("copy fail")}catch(i){console.log(i),console.log("unable to copy")}},stringify:function(t,e){var r,n,i="";if(_.isUndefined(t))i="undefined";else if(_.isBoolean(t))i=t.valueOf()?"true":"false";else if(_.isString(t))i='"'+t+'"';else if(_.isNumber(t))i=t.valueOf();else if(_.isDocument(t))i="#document";else if(_.isElement(t))i=t.tagName.toLowerCase(),i+=t.id?"#"+t.id:"",i+=t.className?"."+t.className.replace(/\s+/g,"."):"";else if(_.isFunction(t))i=t.prototype?"function "+t.prototype.constructor.name+"(){}":"function(){}";else if(_.isArray(t))i="["+t.map(function(t){return _.stringify(t)})+"]";else if(_.isMouseEvent(t))i="MouseEvent",i+="("+_.stringify(t.target)+")";else if(_.isTouchEvent(t))i="TouchEvent",i+="("+_.stringify(t.target)+")";else if(_.isNull(t))i+="null";else if(_.isDate(t))i=_.time(t).format();else{if(_.isDOMRect(t))return _.stringify(t.toJSON());if("object"==typeof t){var o=[];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(o.push('"'+r+'":'),n=t[r],_.isArray(n)?n.forEach(function(t){o.push(_.stringify(t))}):o.push(_.stringify(n)),o.push(","));o.pop(),i="{"+o.join("")+"}"}else i=_.isInfinity(t)?"Infinity":"unknowtype"}return i},toJSONString:function(t){return _.isObject(t)?JSON.stringify(t):t},isHtml:function(t){return/<(\S*?) [^>]*>.*?<\/\1>|<.*?\/?>/.test(t)},preHtml:function(t){return t.replace(/\n/g,"<br>").replace(/\r/g,"<br>")},getBody:function(t){var e=t.match(/<body[^>]*>([\s\S]*)<\/body>/i);return e&&e.length>1?e[1]:t},markdown:function(t){_.isEmpty(t)&&(t='# 标题  ## 标题2  \n*粗体*  **粗体**  _斜体_ \n***分割___分割---  \n> 引用1 \n> 引用2 \n* 列表项目1 \n* 列表项目2 \n- 列表项目1 \n- 列表项目2 \n+ 列表1\n+ 列表2 \n 1. 列表1\n2. 列表2 \n [1连接](www.xxx.com) [2连接](www.xxx.com) [3连接](www.xxx.com) [4连接](www.xxx.com) [5连接](www.xxx.com)\n[Ivan Dementev][]\n[Ivan Dementev]: https://github.com/DiVAN1x \n|表格|字段1|字段2|\n|---|---|---|\n|你好|呵呵|吼吼|\n`for(var i=0;i<10,i++) if(i>=5) alert("")`',console.log(t.replace(/\r?\n/g,"\\r\\n\r\n")));for(var e,r,n=[{tag:"blockquote",reg:/(>\s.+\r?\n)+/g},{tag:"table",reg:/(\|.+\|\r?\n)+/g},{tag:"h6",reg:/#{6}\s(.+)/g},{tag:"h5",reg:/#{5}\s(.+)/g},{tag:"h4",reg:/#{4}\s(.+)/g},{tag:"h3",reg:/#{3}\s(.+)/g},{tag:"h2",reg:/#{2}\s(.+)/g},{tag:"h1",reg:/#{1}\s(.+)/g},{tag:"img",reg:/!\[(.*?)\]\((.*?)\)/g},{tag:"marklink",reg:/\[(.*?)\]\[(.*?)\]/},{tag:"ref",tag:/\[.*?\]:\s+(https?:\/\/.+)/},{tag:"a",reg:/\[(.*?)\]\((.*?)\)|(https?:\/\/.+)/g},{tag:"hr",reg:/[\*|\-|_]{3,}/g},{tag:"strong",reg:/\*\*(.*?)\*\*/g},{tag:"em",reg:/\*(.*?)\*/g},{tag:"i",reg:/[\s\n]_(.*?)_[\s|\n]/g},{tag:"ul",reg:/(?:-\s[\s\S]*)?-\s.*(\r?\n|$)/g},{tag:"ul",reg:/(?:\*\s[\s\S]*)?\*\s.*(\r?\n|$)/g},{tag:"ol",reg:/(\+\s.+\r?\n)+|(\d\.\s.+\r?\n)+/g},{tag:"code",reg:/`([\s\S]+)`/g},{tag:"br",reg:/\r?\n/g}],i=function(t,e){var r=[];r.push("<"),r.push(t);for(var n in e)r.push(" "+n+'="'+e[n]+'"');return r.push(">"),r.join("")},o=function(t){return"</"+t+">"},a=function(t,e,r){return e?i(t,r)+e+o(t):i(t,r)},s=function(t,e){var r=this;return this.replace(e,function(e,n,i,o){switch(t){case"ref":return"";case"marklink":i=i||n;var c=new RegExp("\\["+i+"\\]:(.*?)\\r?\\n","i"),o=r.match(c)[1];return r=r.replace(c,""),a("a",n,o);case"img":return a(t,null,{alt:n,src:i});case"a":return a(t,n||e,{href:i||o});case"br":case"hr":return a(t);case"blockquote":return e=_.escape.call(e),a(t,e);case"ul":return e=s.call(e,"li",/[\*-]\s([\s\S]+?)(?:\n|$)/g),a(t,e);case"ol":return e=s.call(e,"li",/[(?:\d+\.)|\+]\s(.+)\r?\n/g),a(t,e);case"tr":var h=n.split("|").join("</td><td>");return h=a("td",h),a("tr",h);case"table":e=e.replace(/\|.*[\-]{3,}.*\|[\r?\n]/g,"");var u=s.call(e,"tr",/\|(.+)\|[\r?\n]/g);return a(t,u);case"h1":return a(t,n);case"i":return a(t,n);case"li":return a(t,n);case"code":return n=_.escape.call(n),a(t,n);default:return a(t,n)}})},c=0,h=n.length;c<h;c++)e=n[c].reg,r=n[c].tag,t=s.call(t,r,e);return a("article",t,{"class":"markdown-body entry-content"})},isShow:function(t){return t=_.isElement(t)?t:_.query(t),t.offsetWidth>0||t.offsetHeight>0},isHide:function(t){return t=_.isElement(t)?t:_.query(t),t.offsetWidth<=0&&t.offsetHeight<=0},hasClass:function(t){var e=this;return _.isJQuery(e)&&(e=e.get(0)),!!_.isElement(e)&&!!~e.className.split(" ").indexOf(t)},addClass:function(t){var e=this,r=Array.prototype.slice.call(arguments);return 1===r.length&&t&&(r=t.split(" ")),function n(e){if(_.isString(e)&&(e=_.query(e)),_.isElement(e))e.className=_.uniq(e.className.split(" ").concat(r)).join(" ");else if(_.isJQuery(e))e.addClass(t);else if(_.isArray(e))return e.map(function(t){return n(t)});return e}(e)},removeClass:function(t){var e=this,r=Array.prototype.slice.call(arguments);return 1===r.length&&t&&(r=t.split(" ")),r.length>1&&r.forEach(function(t){_.removeClass.call(e,t)}),function n(e){if(_.isString(e)&&(e=_.query(e)),_.isElement(e)){if(e.hasClass(t)){var r=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(r," ").trim()}}else if(_.isJQuery(e))e.removeClass(t);else if(_.isArray(e))return e.map(function(t){return n(t)});return e}(e)},hover:function(t,e){var r=this;return toucher([{el:r,type:"touchstart",callback:function(e,r){e.addClass(t)}},{el:r,type:"touchend",callback:function(r,n){r.removeClass(t),e&&e.call(r,n)}}]),r},tab:function(t,e){var r=this;return toucher([{el:r,type:"touchstart",callback:function(e,r){e.addClass(t).siblings().removeClass(t),_.$("#"+this.attr("target")).show().siblings().hide()}},{el:r,type:"touchend",callback:function(t,r){e&&e.call(t,r)}}]),r},slice:function(t,e){var r=Array.prototype.slice.call(arguments),n=r.length;if(2===n&&_.isArray(t)&&_.isNumber(e)){for(var i=[],o=0;o<Math.ceil(t.length/e);o++){var a=o*e,s=a+e;i.push(t.slice(a,s))}return i}return 0===n?null:1===n?r[0]:r},hasAttr:function(t){var e=this;return _.isElement(e)?!_.isNull(e.getAttribute(t)):_.isJQuery(e)?!_.isUndefined(e.attr(t)):!!_.isString(e)&&_.hasAttr.call(_.query(e),t)},focus:function(t){t.onfocus=function(){window.setTimeout(function(){var e,r;try{window.getSelection&&document.createRange?(r=document.createRange(),r.selectNodeContents(t),r.collapse(!0),r.setEnd(t,t.childNodes.length),r.setStart(t,t.childNodes.length),e=window.getSelection(),e.removeAllRanges(),e.addRange(r)):document.body.createTextRange&&(r=document.body.createTextRange(),r.moveToElementText(t),r.collapse(!0),r.select())}catch(n){console.log(n)}},1)},t.focus()},isImgLoad:function(t){return isIE?"complete"===t.readyState:t.complete},loadImg:function(t,e){var r;if(_.isImage(t))r=t;else if(_.isCanvas(t)){var n=t;r=new Image,r.src=n.toDataURL("image/jpeg")}else r=new Image,r.src=t;_.isImgLoad(r)?e&&e.call(r,r):(addEvent("load",r,function(){e&&e.call(r,r)}),r.onerror=function(t){console.log("加载图片失败："+t.path[0].src)})},toDataURL:function(t,e){var r=function(t){var r=document.createElement("canvas"),n=r.getContext("2d"),i=t.width,o=t.height;r.width=i,r.height=o,n.drawImage(t,0,0,i,o);var a=new Image;a.onload=function(){e&&e(a)},a.src=r.toDataURL("image/jpeg")};_.loadImg(t,r)},toCanvas:function(t,e){var r=function(t){var r=document.createElement("canvas"),n=r.getContext("2d"),i=t.width,o=t.height;r.width=i,r.height=o,n.drawImage(t,0,0,i,o),e&&e(r)};_.loadImg(t,r)},cutImg:function(t,e,r,n){var e=_.isUndefined(e)?3:e,r=_.isUndefined(r)?3:r,i=function(t){var i=document.createElement("canvas"),o=i.getContext("2d"),a=t.width,s=t.height;i.width=a,i.height=s;for(var c=[],h=a/e,u=s/r,l=0,f=0;f<r;f++)for(var p=0;p<e;p++){o.drawImage(t,p*h,f*u,h,u,0,0,a,s);var d=new Image;d.src=i.toDataURL("image/jpeg"),d.width=h,d.height=u,d.className="thumbnail",d.id="_thumbnail_"+l++,c.push(d)}n&&n(c)};_.loadImg(t,i)},zipImg:function(t){var e=document.createElement("canvas"),r=t.img,n=t.width,i=t.height,o=t.quality,a=t.zoom,s=t.callback;_.loadImg(r,function(){_.isUndefined(n)&&_.isUndefined(i)&&!_.isUndefined(a)&&(n=this.width*a,i=this.height*a),e.width=n,e.height=i;var t=e.getContext("2d");t.drawImage(this,0,0,n,i);var r=new Image;r.src=e.toDataURL("image/jpeg",o),_.loadImg(r,s)})},reverse:function(t,e){var r=function(t){var r=document.createElement("canvas"),n=r.getContext("2d"),i=t.width,o=t.height;r.width=i,r.height=o,n.drawImage(t,0,0);for(var a=n.getImageData(0,0,i,o),s=0;s<a.data.length;s+=4)a.data[s]=255-a.data[s],a.data[s+1]=255-a.data[s+1],a.data[s+2]=255-a.data[s+2],a.data[s+3]=255;n.putImageData(a,0,0);var c=new Image;c.src=r.toDataURL("image/jpeg"),e&&e(c)};_.loadImg(t,r)},masic:function(t,e){},timeSeq:function(t,e,r){t.forEach(function(t,n){setTimeout(function(){r&&r(t)},(e||500)*n)})},background:function(t,e){var t=_.query(t);_.loadImg(e,function(e){t.style.backgroundImage='url("'+e.src+'")'})},each:function(t,e,r){if(null==t)return t;if(Array.prototype.forEach&&t.forEach===Array.prototype.forEach)t.forEach(e,r);else if(t.length===+t.length){for(var n=0,i=t.length;n<i;n++)if(e.call(r,t[n],n,t)==={})return}else for(var o=_.keys(t),n=0,i=o.length;n<i;n++)if(e.call(r,t[o[n]],o[n],t)==={})return;return t},any:function(t,e,r){e||(e=function(t){return t});var n=!1;return null==t?n:Array.prototype.some&&t.some===Array.prototype.some?t.some(e,r):(_.each(t,function(t,i,o){if(n||(n=e.call(r,t,i,o)))return{}}),!!n)},contains:function(t,e){return null!=t&&(t==e||(Array.prototype.indexOf&&t.indexOf===Array.prototype.indexOf?!!~t.indexOf(e):_.any(t,function(t){return t===e})))},size:function(t){return null==t?0:t.length===+t.length?t.length:_.keys(t).length},filter:function(t,e,r){var n=[];return null==t?n:Array.prototype.filter&&t.filter===Array.prototype.filter?t.filter(e,r):(_.each(t,function(t,i,o){e.call(r,t,i,o)&&n.push(t)}),n)},max:function(t){var e=arguments.length;if(0===e)return 0;for(var r=new Array(e);e--;)r[e]=arguments[e];return Math.max.apply(Math,_.flatten(r))},min:function(t){var e=arguments.length;if(0===e)return 0;for(var r=new Array(e);e--;)r[e]=arguments[e];return Math.min.apply(Math,_.flatten(r))},clone:function(t){if(!_.isObject(t))return t;if(_.isArray(t))return t.slice();for(var e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r.unshift({}),_.extend.apply(null,r)},invert:function(t){var e={};return _.keys(t).forEach(function(r){e[t[r]]=r}),e}};[{key:"hide",reverse:"show"},{key:"active",reverse:"passive"},{key:"disabled",reverse:"available"},{key:"fadeout",reverse:"fadein",type:"animate"},{key:"fadeoutup",reverse:"fadeindown",type:"animate"},{key:"fadeinup",reverse:"fadeoutdown",type:"animate"},{key:"fadeoutleft",reverse:"fadeinright",type:"animate"},{key:"fadeinleft",reverse:"fadeoutright",type:"animate"}].forEach(function(t){_[t.key]=function(){var e,r=arguments.length;if(0!==r){if(1===r)e=arguments[0];else for(e=new Array(r);r--;)e[r]=arguments[r];return"animate"===t.type&&_.removeClass.call(e,t.reverse,"hide"),_.addClass.call(e,t.key)}},_[t.reverse]=function(){var e,r=arguments.length;if(0!==r){if(1===r)e=arguments[0];else for(e=new Array(r);r--;)e[r]=arguments[r];return"animate"===t.type?(_.addClass.call(e,t.reverse),_.removeClass.call(e,t.key,"hide")):_.removeClass.call(e,t.key)}}}),["Null","Undefined","Array","String","Number","Boolean","Function","RegExp","NaN","Infinity","NodeList","Arguments","Window","TouchEvent","MouseEvent","Screen","Date","DOMRect"].forEach(function(t){_["is"+t]=function(e){return _.type(e)===t.toLowerCase()}}),_.isObject=function(t){return!!_.isElement(t)||"object"===_.type(t)},["Div","Image","Canvas"].forEach(function(t){_["is"+t]=function(e){return _.type(e)==="html"+t.toLowerCase()+"element"}}),_.isEmpty=function(t){if(null==t)return!0;if(_.isNumber(t))return!1;if(_.isDate(t))return!1;if(_.isArray(t)||_.isString(t))return 0===t.length;if(_.isElement(t))return 0===_.size(t);for(var e in t)if(_.has(t,e))return!1;return!0},_.uniq=_.unique=function(t,e,r,n){_.isFunction(e)&&(n=r,r=e,e=!1);var i=r?_.map(t,r,n):t,o=[],a=[];return _.each(i,function(r,n){(e?n&&a[a.length-1]===r:_.contains(a,r))||(a.push(r),o.push(t[n]))}),o},_.identity=function(t){return t},_.every=_.all=function(t,e,r){e||(e=_.identity);var n=!0;return null==t?n:Array.prototype.every&&t.every===Array.prototype.every?t.every(e,r):(_.each(t,function(t,i,o){if(!(n=n&&e.call(r,t,i,o)))return breaker}),!!n)},_.intersection=function(t){var e=Array.prototype.slice.call(arguments,1);return _.filter(_.uniq(t),function(t){return _.every(e,function(e){return _.contains(e,t)})})},_.difference=function(t){var e=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));return _.filter(t,function(t){return!_.contains(e,t)})},_.without=function(t){return _.difference(t,Array.prototype.slice.call(arguments,1))},_.map=_.collect=function(t,e,r){var n=[];return null==t?n:Array.prototype.map&&t.map===Array.prototype.map?t.map(e,r):(_.each(t,function(t,i,o){n.push(e.call(r,t,i,o))}),n)},_.property=function(t){return function(e){return e[t]}},_.pluck=function(t,e){return _.map(t,_.property(e))},_.indexOf=function(t,e){return _.isUndefined(t)||_.isUndefined(e)?-1:_.isAarray(t)?t.indexOf(e):_.isString(t)?t.toLowerCase().indexOf(e.toLowerCase()):void 0},_.flatten=function(t,e){var r=function(t,e,n){return t.forEach(function(t){_.isArray(t)?e?n[n.length]=t:r(t,e,n):n[n.length]=t}),n};return r(t,e,[])},_.split=function(t,e){var r=[],n=[];if(t.forEach(function(t,i){n[n.length]=t,i%e===e-1&&(r[r.length]=n,n=[])}),arguments.length>2){var i=Array.prototype.slice.call(arguments,2);return i.unshift(r),_.split.apply(this,i)}return r},_.getVal=function(t,e){function r(t,e){if(_.isUndefined(t)||0===e.length)return"";var n=e.shift();return 0===e.length?t[n]:r(t[n],e)}return _.isArray(e)?r(t,e):r(t,e.split("."))},_.setVal=function(t,e,r){var n=function(t,e,r,i){if(0===e.length)return t=r;if(1===e.length)return t[e[0]]=r,i||t;var o=e.shift();return t[o]=_.isObject(t[o])?t[o]:{},n(t[o],e,r,t)};return _.isArray(e)?n(t,e,r,t):n(t,e.split("."),r,t)},_.$=_.query;var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};["escape","unescape"].forEach(function(t){_[t]=function(e){return null==e?"":(""+e).replace(entityRegexes[t],function(e){return entityMap[t][e]})}}),_.toQueryPair=function(t,e){return encodeURIComponent(String(t))+"="+encodeURIComponent(String(e))},_.toQueryString=function(t){var e=[];for(var r in t)e.push(_.toQueryPair(r,t[r]));return e.join("&")},_.ajax=function(t){function e(){try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){i=!1}}i||"undefined"==typeof XMLHttpRequest||(i=new XMLHttpRequest)}function r(){if(e(),i)try{i.onreadystatechange=n,"GET"===s.method?(s.data&&(t+=(~t.indexOf("?")?"&":"?")+s.data,s.data=null),i.open("GET",t,s.isAsync),i.setRequestHeader("Content-Type",s.contentType||"text/plain;charset=UTF-8"),i.send()):"POST"===s.method?(i.open("POST",t,s.isAsync),i.setRequestHeader("Content-Type",s.contentType||"application/x-www-form-urlencoded;charset=UTF-8"),i.send(s.data)):(i.open(s.method,t,s.isAsync),i.send())}catch(r){console.log(r)}}function n(){if(o)return!0;var e={},r=e.responseText=i.responseText;if(e.responseXML=i.responseXML,e.data=s.data,e.status=i.status,e.uri=t,e.arguments=s.arguments,"json"===s.dataType)try{r=e.responseJSON=JSON.parse(i.responseText)}catch(n){}if(4==i.readyState){switch(i.status){case 200:s.success.call(r,r);break;default:var a={400:"错误的请求！\nError Code:400!",403:"拒绝请求！\nError Code:403!",404:"请求地址不存在！\nError Code:404!",500:"内部错误！\nError Code:500!",503:"服务不可用！\nError Code:503!"},c=a[i.status]?a[i.status]:"请求返回异常！\nError Code:"+i.status;console.log(c),s.error(e)}return o=!0}s.error(e);var h={0:"Uninitialized",1:"Loading",2:"Loaded",3:"Interactive",4:"Complete"};return console.log(t+" ("+h[i.readyState]+")"),!1}var i=!1,o=!1,a=0,s={method:"GET",data:null,arguments:null,success:function(){},error:function(){},complete:function(){},isAsync:!0,timeout:3e4,contentType:null,dataType:"json"},c=Array.prototype.slice.call(arguments),h=c.length;h>=2&&(_.isFunction(c[1])?_.extend(s,{success:c[1]}):_.isObject(c[1])&&(_.extend(s,c[1]),_.isObject(s.data)&&(s.data=_.toQueryString(s.data)))),h>=3&&_.isFunction(c[2])&&_.extend(s,{error:c[2]});var u=function(){return o?void(a=0):a>=5?(console.log("请求超时"),void(a=0)):(a++,o=n(),void setTimeout(u,100*(a+1)))};r(),setTimeout(u,15)},_.get=function(t,e){_.ajax(t,e,"GET")},_.post=function(t,e){_.ajax(t,e,"POST")},_.loading=function(t,e,r){if(_.isString(t)&&(t=_.query(t)),_.isElement(t)){var n=["~oo~","^oo^","^oo~","~oo^"],i=!1,o=function(){i||setTimeout(function(){t.query(".tip").text(n.random()),o()},100)};r&&o(),setTimeout(function(){i=!0,t.hide(),e&&e()},1e3)}},_.loadFile=function(t,e,r){var n=t.query("data-file".brackets()),i=function(t,r){_.isFunction(e)?e.call(t,t,r):t.html(r)},o=function(t,e){_.isFunction(r)&&r.call(t,t,e)};_.isElement(n)?_.ajax(n.attr("data-file"),function(t){i(n,t)},function(t){o(n,t)}):_.isArray(n)&&n.forEach(function(t){_.ajax(t.attr("data-file"),function(e){i(t,e)},function(e){o(t,e)})})},_.updateAfterImgLoad=function(t,e){function r(t){o.each(function(){if(0===this.height)return a=!1}),a?(clearTimeout(n),t()):(a=!0,n=setTimeout(function(){r(t)},500))}var n,i=_.query("#"+t),o=i.query("img"),a=!0;o&&o.length>0&&r(function(){e&&e()})},_.polyfill=function(t,e,r){for(var n=0,i=e.length;n<i;n++){var o=t[e[n]];if(_.isFunction(o))return t[e[0]]=o}return t[e[0]]=r},_.selectorMatches=function(t,e){var r=Element.prototype,n=r.matches||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||function(t){return!!~Array.prototype.slice.call(document.querySelectorAll(t)).indexOf(this)};return n.call(t,e)},_.closest=function(t){for(var e=this;e;){if(e&&_.selectorMatches(e,t))return e;e=e.parentElement}return[]};var lookupIterator=function(t){return null==t?_.identity:_.isFunction(t)?t:_.property(t)};_.sortBy=function(t,e,r){return e=lookupIterator(e),_.pluck(_.map(t,function(t,n,i){return{value:t,index:n,criteria:e.call(r,t,n,i)}}).sort(function(t,e){var r=t.criteria,n=e.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(r<n||void 0===n)return-1}return t.index-e.index}),"value")};var _time=_.time=function(t){return new _time.prototype.init(t)};_time.toDate=function(t){return _.isDate(t)?new Date((+t)):_.isEmpty(t)?new Date:/^\d*$/.test(t)?new Date((+t)):_.isString(t)?(this.isTimeString(t)&&(t=this().format("yyyy-MM-dd")+" "+t),new Date(Date.parse(t.replace(/-/g,"/")))):t},_time.isTimeString=function(t){return/^(\d{1,2}):(\d{1,2})(?::(\d{1,2}))?$/.test(t)},_time.set=function(t,e){return this.toDate(e?t+" "+e:t)},_time.zerofill=function(t){return t=""+t,t[1]?t:"0"+t},_time.durationFormat=function(t){var e=this;if("number"!=typeof t||t<0)return"00:00";var r=t/3600<<0;t%=3600;var n=t/60<<0;t%=60;var i=t<<0,o=[n,i];return r>0&&o.unshift(r),o.map(function(t){return e.zerofill(t)}).join(":")},_time.shortNameMap=function(t){t=(""+t).toLowerCase();var e={y:"year",m:"month",d:"day",w:"week",h:"hour",n:"minute",min:"minute",s:"second",l:"msecond",ms:"msecond"};return t in e?e[t]:t},_time.diff=function(t,e,r){var n=this(e),i=this(r),o=n.time-i.time,a=1e3,s=60*a,c=60*s,h=24*c;switch(this.shortNameMap(t)){case"year":result=n.year-i.year;break;case"month":result=12*(n.year-i.year)+(n.month-i.month);break;case"day":result=Math.round(o/h);break;case"hour":result=Math.round(o/c);break;case"minute":result=Math.round(o/s);break;case"second":result=Math.round(o/a);break;case"msecond":result=o;break;case"week":result=Math.round(o/h)%7;break;default:result="invalid"}return result},_time.add=function(t,e,r){var r=this.toDate(r);switch(this.shortNameMap(t)){case"year":return new Date(r.setFullYear(r.getFullYear()+e));case"month":return new Date(r.setMonth(r.getMonth()+e));case"day":return new Date(r.setDate(r.getDate()+e));case"week":return new Date(r.setDate(r.getDate()+7*e));case"hour":return new Date(r.setHours(r.getHours()+e));case"minute":return new Date(r.setMinutes(r.getMinutes()+e));case"second":return new Date(r.setSeconds(r.getSeconds()+e));case"msecond":return new Date(r.setMilliseconds(r.getMilliseconds()+e))}return r},_time.prototype={constructor:_time,init:function(t){var e=this.date=this.constructor.toDate(t);this.year=e.getFullYear(),this.month=e.getMonth()+1,this.day=e.getDate(),this.hour=e.getHours(),this.minute=e.getMinutes(),this.second=e.getSeconds(),this.msecond=e.getMilliseconds(),this.day_of_week=0===e.getDay()?7:e.getDay(),this.time=e.getTime(),this.quarter=(e.getMonth()+3)/3<<0},format:function(t){var e=this;t=t||"yyyy-MM-dd hh:mm:ss.S";var r=(this.date,{"y+|Y+":this.year,"M+":this.month,"d+|D+":this.day,"h+|H+":this.hour,"m+":this.minute,"s+":this.second,"q+":this.quarter,S:this.msecond});return _.keys(r).forEach(function(n,i){var o=""+r[n];t=t.replace(new RegExp(n,"g"),function(t){return 0===i?o.substr(4-t.length):t[1]?e.constructor.zerofill(o):o})}),t},set:function(t){return this.constructor.isTimeString(t)&&(t=this.format("yyyy-MM-dd")+" "+t),this.constructor.toDate(t)},setCurTime:function(){return this.set(this.constructor().format("HH:mm:ss"))},add:function(t,e,r){return this.constructor.add(t,e,r)},utc:function(){return Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.msecond)},zone:function(){return(this.time-this.utc())/36e5},diff:function(t,e){return this.constructor.diff(t,this.date,e)},week:function(t){var e=0,r=t?this.constructor(t):this;if(!r)return"";var n=r.year,i=r.month-1,o=r.day,a=[31,28,30,31,30,31,31,30,31,30,31];return Math.round(n/4)===n/4&&(a[1]=29),a.forEach(function(t,r){r<=i&&(e+=o+(0===r?0:a[r-1]))}),Math.ceil(e/7)}},_time.prototype.init.prototype=_time.prototype;var _color=_.color=function(t){return new _color.prototype.init(t)};_color.prototype={constructor:_color,init:function(t){this.a=0},isHex:function(t){return/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)},isHex3:function(t){return/^#([0-9a-fA-f]{3})$/.test(t)},isHex6:function(t){return/^#([0-9a-fA-f]{6})$/.test(t)},isRgba:function(t){return/^[rR][gG][Bb][Aa]?[\(]([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),){2}[\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),?[\s]*(0\.\d{1,2}|1|0)?[\)]{1}$/g.test(t)},hsla:function(){return"hsla("+[360*Math.random()<<0]+",50%,50%,0.5)"},hsl:function(){return"hsl("+[360*Math.random()<<0]+",50%,50%)"},rgbaArr:function(t){return t.match(/0\.\d{1,2}|\d{1,3}/g).map(function(t){return+t})},rgbaWrapper:function(t){return(4===t.length?"rgba(":"rgb(")+t+")"},dark:function(t,e){var r=3*Math.random()<<0;return t?(t=this.rgb(t),e=e||.5,this.rgbaWrapper(this.rgbaArr(t).map(function(t){return t*(1-e)<<0}))):this.rgbaWrapper([255,255,255].map(function(t,e){return e!==r?80*Math.random()<<0:t*Math.random()<<0}))},deepdark:function(){var t=3*Math.random()<<0;return this.rgbaWrapper([255,255,255].map(function(e,r){return r!==t?20*Math.random()<<0:e*Math.random()<<0}))},light:function(t,e){var r=3*Math.random()<<0;return t?(t=this.rgb(t),e=e||.5,this.rgbaWrapper(this.rgbaArr(t).map(function(t){return t+(255-t)*e<<0}))):this.rgbaWrapper([255,255,255].map(function(t,e){return e!==r?120+136*Math.random()<<0:t*Math.random()<<0}))},rgba:function(t,e,r,n){var i=arguments.length;i<4&&(n=_.between(.1,.7)),i<3&&(r=1),i<2&&(e=1),i<1&&(t=1);var o=[t,e,r];if(t&e&1===r)o=o.map(function(t){return 255*Math.random()<<0});else if(t|e|0===r){var a=255*Math.random()<<0;o=[a,a,a]}else{var s=155,c=Math.random()*(255-s)<<0+s;o=o.map(function(t){return 1===t?Math.random()*(255-s)<<0+s:Math.random()*(c/2)<<0})}return o[o.length]=n,this.rgbaWrapper(o)},rgb:function(t,e){if(!t)return this.rgb(this.hex());
if(this.isRgba(t)){if(e){var r=this.rgbaArr(t);return r[3]=e,this.rgbaWrapper(r)}return t}if(t=this.hex(t),!this.isHex(t))return t;var n;return n=4===t.length?t.match(/[0-9a-fA-f]{1}/g).map(function(t){return"0x"+t+t<<0}):t.match(/[0-9a-fA-f]{2}/g).map(function(t){return"0x"+t<<0}),e&&(n[n.length]=e),this.rgbaWrapper(n)},mix:function(t,e){var t=this.rgb(t),e=this.rgb(e),r=this.rgbaArr(t),n=this.rgbaArr(e),i=r.map(function(t,e){return 3===e?(_.isUndefined(n[e])&&(n[e]=1),((t+n[e])/2).toFixed(2)):(t+n[e])/2<<0});return this.rgbaWrapper(i)},hex:function(t){return t?this.isRgba(t)?this.isHex6(t)?t:this.isHex3(t)?t.replace(/[0-9a-fA-f]/g,function(t){return t+t}):"#"+this.rgbaArr(t).map(function(t,e){return e>2?null:("0"+(+t).toString(16)).slice(-2)}).join(""):t:"#"+("00000"+(16777216*Math.random()<<0).toString(16)).slice(-6)},circle:function(t){if(!t){t=this.len||50,this.a+=360/t;var e=127*_.cos(this.a)+128<<0,r=127*_.cos(this.a+120)+128<<0,n=127*_.cos(this.a+240)+128<<0;return this.rgbaWrapper([e,r,n])}for(var i=[],o=0;o<t;o++)this.len=t,i[i.length]=this.circle();return i},complementary:function(t){var e=this.rgb(t),r=this.rgbaArr(e),n=r[0],i=r[1],o=r[2],a=Math.max(n,Math.max(i,o)),s=Math.min(n,Math.min(i,o)),c=a+s,h=c-n,u=c-i,l=c-o;return this.rgbaWrapper([h,u,l])},tween:function(t,e,r,n){t=this.rgb(t),e=this.rgb(e),r=r||1,n=n||"linear";for(var i=this.rgbaArr(t),o=this.rgbaArr(e),a=[],s=0;s<=r;s++){var c=_.Easing[n](s/r);a[a.length]=this.rgbaWrapper(o.map(function(t,e){return e>2?+(i[e]+(t-i[e])*c).toFixed(2):i[e]+(t-i[e])*c<<0}))}return a},grayLevel:function(t){return t=this.rgb(t),t=this.rgbaArr(t),.3*t[0]+.59*t[1]+.11*t[2]},isDark:function(t){return this.grayLevel(t)<192},isLight:function(t){return!this.isDark(t)},webSafeColor:function(t){if(!t){for(var e=["00","33","66","99","CC","FF"],r=e.length,n=[],i=0;i<r;i++)for(var o=0;o<r;o++)for(var a=0;a<r;a++)n[n.length]="#"+e[i]+e[o]+e[a];return n}t=this.rgb(t),t=this.rgbaArr(t);for(var s=0;s<3;s++){var c=51*Math.floor(t[s]/51),h=51*Math.ceil(t[s]/51);Math.abs(c-t[s])<=Math.abs(h-t[s])?t[s]=c:t[s]=h}return this.hex(this.rgbaWrapper(t))}},_color.prototype.init.prototype=_color.prototype;var _prototype={};_prototype.obj={cmd:function(str){if(!_.isString(str))return console.log("object.cmd need a string argument"),"";var self=this,symbol=str.match(reg_operation_symbol),ps=[],_cmd=function(t){if(0==symbol.length)return void ps.push("self."+t);var e=symbol.shift(),r=t.indexOf(e),n=t.substring(0,r).trim();_.has(self,n)?ps.push("self."+n+e):ps.push(n+e);var i=t.substring(r+e.length);_cmd(i)};return _cmd(str),eval(ps.join(""))}},_prototype.num={isEqual:function(t,e){return e=void 0==e?10:e,this.toFixed(e)===t.toFixed(e)},add:function(t){var e,r,n;try{e=t.toString().split(".")[1].length}catch(i){console.log(i),e=0}try{r=this.toString().split(".")[1].length}catch(i){console.log(i),r=0}n=Math.pow(10,Math.max(e,r));var o=Math.round(t*n+this*n)/n;return o.isInfinity(function(){console.log(e+" "+r+"  "+this+" "+t)}),o},sub:function(t){var e,r,n,i;try{e=this.toString().split(".")[1].length}catch(o){console.log(o),e=0}try{r=t.toString().split(".")[1].length}catch(o){console.log(o),r=0}return n=Math.pow(10,Math.max(e,r)),i=e>=r?e:r,((this*n-t*n)/n).toFixed(i)},mul:function(t){var e=0,r=t.toString(),n=this.toString();try{e+=r.split(".")[1].length}catch(i){console.log(i)}try{e+=n.split(".")[1].length}catch(i){console.log(i)}return Number(r.replace(".",""))*Number(n.replace(".",""))/Math.pow(10,e)},div:function(t){var e,r,n,i,o=0,a=0;try{o=this.toString().split(".")[1].length}catch(s){console.log(s)}try{a=t.toString().split(".")[1].length}catch(s){console.log(s)}return 0===a&&0===o?n=this/t:(e=+this.toString().replace(".",""),r=+t.toString().replace(".",""),o<a?(i=Math.pow(10,a-o),n=e/r*i):o>a?(i=Math.pow(10,o-a),n=Math.round(e/r)/i):n=e/r),n.isInfinity(function(){console.log(e+" "+r+" "+(a-o)+" "+this+" "+t)}),n},isInfinity:function(t){var e=function(){return this.toString().indexOf(".")>0&&this.toString().split(".")[1].length>5&&(t&&t.call(this),!0)};return e.call(this)}},_prototype.str={pound:function(){return"#"+this},brackets:function(t){if(t){var e;_.isElement(t)?(_.autoid(t),e=t.id):_.isString(t)&&(e=t);var r=this.split(",");return"#"+e+"["+r.join("],#"+e+"[")+"],#"+e+" ["+r.join("],#"+e+" [")+"]"}return"["+this.split(",").join("],[")+"]"},format:function(){var t=Array.prototype.slice.call(arguments),e=this;return t.forEach(function(t){e=e.replace(/{.*?}/,t)}),e}},_prototype.dat={format:function(t){return _time(this).format(t)}},_prototype.ele={length:{value:1,writable:!1},attr:function(t,e){return _.isUndefined(e)?this.getAttribute(t):(this.setAttribute(t,e),this)},remove:function(){this.parentNode&&this.parentNode.removeChild(this)},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(this.removeChild(t),t.textContent="");return this},removeAttr:function(t){var e=this,r=t.split(","),n=r.length;return 1===n?e.removeAttribute(t):r.forEach(function(t){e.removeAttribute(t)}),e},html:function(t){return 0===arguments.length?this.innerHTML:(this.innerHTML=arguments[0],this)},text:function(t){return t&&(this.innerText=t),this.innerText},val:function(t){return t?(this.setAttribute("value",t),this):~["select","input"].indexOf(this.tagName.toLowerCase())?this.value:this.getAttribute("value")},on:function(t,e){return addEvent(t,this,e),this},off:function(t,e){return removeEvent(t,this,e),this},trigger:function(t){console.log("event trigger");var e=document.createEvent("UIEvents");return e.initEvent(t,!0,!0),dispatchEvent(e,this),this},each:function(t){_.isFunction(t)&&t.call(this,this,0)},css:function(t){var e=Array.prototype.slice.call(arguments),r=e.length,n=["font-size","line-height","border-radius","border-width","padding","margin"];["padding","margin",""].forEach(function(t){n=n.concat(["top","left","bottom","right"].map(function(e){return t?t+"-"+e:e}))}),["max","min",""].forEach(function(t){n=n.concat(["width","height"].map(function(e){return t?t+"-"+e:e}))});var i=function(t,e){return/^0$/.test(e)?e:~n.indexOf(t)?(""+e).replace(/^\d+(\.\d+)?$/,function(t){return t+"px"}):e};if(1===r){if(_.isObject(t))for(key in t){var o=t[key];o=i(key,o),this.style[key]=o}}else 2===r&&(this.style[t]=e[1]);return this},width:function(){var t=Array.prototype.slice.call(arguments),e=t.length;return 1===e&&this.css({width:t[0]}),this.offsetWidth},height:function(){var t=Array.prototype.slice.call(arguments),e=t.length;return 1===e&&this.css({height:t[0]}),this.offsetHeight},pos:function(t){var e=Array.prototype.slice.call(arguments),r=e.length;return 1===r?this.css({position:"absolute",top:t.y,left:t.x}):_.pos.call(this,this)},outerWidth:function(){return _.max(this.scrollWidth,this.offsetWidth,this.clientWidth)+Number(this.style.marginLeft)+Number(this.style.marginRight)},dir:function(t,e,r){for(var n=[],i=void 0!==r;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(i&&jQuery(t).is(r))break;n.push(t)}return n},parent:function(){return this.parentNode},sibling:function(t,e){for(var r=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&r.push(t);return r},siblings:function(){return this.sibling((this.parentNode||{}).firstChild,this)},children:function(t){return this.sibling(t.firstChild)},first:function(){return this},last:function(){return this},filter:function(t){switch(t){case"visible":return _.isShow(this)?this:null;case"hidden":return _.isHide(this)?this:null;default:return this}},append:function(t){return _.isElement(t)?this.appendChild(t):void(_.isString(t)&&(this.innerHTML=this.innerHTML+t))},onTap:function(t){toucher({el:this,type:"tap",listener:t})}},["hide","show","isHide","active","passive"].forEach(function(t){_prototype.ele[t]=function(){return _[t]&&_[t].call(this,this)}}),["$","query","hover","tab","hasAttr","hasClass","addClass","removeClass","closest"].forEach(function(t){_prototype.ele[t]=function(){return _[t]&&_[t].apply(this,arguments)}}),_prototype.arr={query:function(t){var e=[];return _.each(this,function(r){if(_.isElement(r)){var n=_.autoid(r).query(t);_.size(n)>=1&&e.push(n)}}),1===e.length?e[0]:e},each:function(t){_.isFunction(t)&&_.each(this,function(e,r){t.call(e,e,r)})},first:function(){return this[0]},last:function(){return this[this.length-1]},random:function(){return this[Math.random()*this.length<<0]},shuffle:function(){for(var t=this.length,e=0;e<t-1;e++){var r=Math.random()*(t-e)<<0,n=this[r];this[r]=this[t-e-1],this[t-e-1]=n}}},_prototype.arr.$=_prototype.arr.query,["attr","remove","removeAttr","removeClass","addClass","html","filter","append","on","off","trigger","css","addEvent","hide","show","active","passive","clearEvent","hover","tab","siblings"].forEach(function(t){_prototype.arr[t]=function(){var e=Array.prototype.slice.call(arguments),r=e.length,n=this;if(0===n.length)return n;if(1===r&&_.isString(e[0])){var i=[];return n.forEach(function(r){_.isElement(r)&&i.push(r[t].apply(r,e))}),i}return n.forEach(function(r){_.isElement(r)&&r[t].apply(r,e)}),n}}),_.extproto=function(t){for(var e=Array.prototype.slice.call(arguments),r=e.length,n=1;n<r;n++){var i=e[n];if(i)try{for(var o in i)if(_.isObject(i[o]))Object.defineProperty(t,o,i[o]);else if(_.isFunction(i[o]))if(Object.prototype.hasOwnProperty.call(t,o))console.log(t,"obj hasOwnProperty "+o);else{t[o]=i[o];var a=Object.getOwnPropertyDescriptor(t,o);a.enumerable=!1,Object.defineProperty(t,o,a)}else Object.prototype.hasOwnProperty.call(t,o)||(t[o]=i[o])}catch(s){console.log(s)}}return t},inBrowser&&_.extproto(Element.prototype,_prototype.ele),_.extproto(Date.prototype,_prototype.dat),[Object,Number,String,Array,Boolean].forEach(function(t,e){var r=_.type(t.prototype).slice(0,3);_prototype[r]=_prototype[r]||{},_prototype[r].log=function(){console.log(_.stringify(this))},_.extproto(t.prototype,_prototype[r])});var Base64_encode=_.encode=function(t){var e=function(t){return encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode("0x"+e)})};if("undefined"==typeof window)return new Buffer(t).toString("base64");"undefined"!=typeof window.btoa&&window.btoa(e(t));var r,n,i,o,a,s,c,h,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,f=0,p="",d=[];if(!t)return t;t=e(t);do r=t.charCodeAt(l++),n=t.charCodeAt(l++),i=t.charCodeAt(l++),h=r<<16|n<<8|i,o=h>>18&63,a=h>>12&63,s=h>>6&63,c=63&h,d[f++]=u.charAt(o)+u.charAt(a)+u.charAt(s)+u.charAt(c);while(l<t.length);p=d.join("");var v=t.length%3;return(v?p.slice(0,v-3):p)+"===".slice(v||3)},Base64_decode=_.decode=function(t){var e=function(t){return decodeURIComponent(t.split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))};if("undefined"==typeof window)return new Buffer(t,"base64").toString("utf-8");if("undefined"!=typeof window.atob)return e(window.atob(t));var r,n,i,o,a,s,c,h,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,f=0,p="",d=[];if(!t)return t;t+="";do o=u.indexOf(t.charAt(l++)),a=u.indexOf(t.charAt(l++)),s=u.indexOf(t.charAt(l++)),c=u.indexOf(t.charAt(l++)),h=o<<18|a<<12|s<<6|c,r=h>>16&255,n=h>>8&255,i=255&h,64===s?d[f++]=String.fromCharCode(r):64===c?d[f++]=String.fromCharCode(r,n):d[f++]=String.fromCharCode(r,n,i);while(l<t.length);return p=d.join(""),e(p.replace(/\0+$/,""))},addEvent=function(t,e,r){_.isFunction(r)?(window.addEventListener?e.addEventListener(t,r,{passive:!1}):e.attachEvent("on"+t,r),e.events||(e.events=[]),e.events.push({type:t,el:e,listener:r})):_.isArray(r)&&r.forEach(function(r){addEvent(t,e,r)})},removeEvent=function(t,e,r){if(!_.isElement(e))return!1;if(r){window.removeEventListener?e.removeEventListener(t,r,{passive:!1}):e.detachEvent("on"+t,r),e.events||(e.events=[]);for(var n=e.events.length;n--;)e.events[n].type===t&&e.events[n].listener===r&&e.events.splice(n,1)}else e.events&&e.events.forEach(function(t){removeEvent(t.type,t.el,t.listener)})},startPos={},endPos={},offset={},_touchstar=isSupportTouch?"touchstart":"mousedown",_touchend=isSupportTouch?"touchend":"mouseup",_touchmove=isSupportTouch?"touchmove":"mousemove",Events=function(){var t=[];return{store:function(e){return e&&t.push(e),t},filter:function(e){return _.filter(t,function(t){var r=!0;for(x in e)t[x]!==e[x]&&(r=!1);return r})},reset:function(){t=[]},on:function(t,e,r,n){var i=this;switch(isSupportTouch||t!==TAP||(t="click"),t){case TAP:var o=function(t){startPos=_.pos(t)},a=function(o){endPos=_.pos(o);var a=endPos.x-startPos.x,s=endPos.y-startPos.y,c=endPos.time-startPos.time;Math.abs(a)<=5&&Math.abs(s)<=5&&c<200&&(_.isFunction(r)?r.call(e,endPos.el,o):_.isArray(r)&&r.forEach(function(t){t.call(e,endPos.el,o)}),n&&i.off(t,e))};addEvent(_touchstar,e,o),addEvent(_touchend,e,a);break;case LONGTAP:var s,o=function(o){s=setTimeout(function(){_.isFunction(r)?r.call(e,e,o):_.isArray(r)&&r.forEach(function(t){t.call(e,e,o)}),n&&i.off(t,e)},1e3)},a=function(t){s&&clearTimeout(s)};addEvent(_touchstar,e,o),addEvent(_touchend,e,a);break;case DRAG:case"drag-y":case"drag-x":var c,h=function(t){t.preventDefault()},u=document.documentElement.clientWidth-e.clientWidth,l=document.documentElement.clientHeight-e.clientHeight,o=function(t){startPos=_.pos(t),offset=_.pos(e),e.css({position:"absolute",cursor:"move"}),c=!0,addEvent(_touchmove,document,h)},f=function(r){endPos=_.pos(r),c&&function(){var r=endPos.x-startPos.x+offset.x,n=endPos.y-startPos.y+offset.y;r=_.between(0,u,r),n=_.between(0,l,n),"drag-y"!==t&&e.css({left:r+"px"}),"drag-x"!==t&&e.css({top:n+"px"})}()},a=function(t){endPos=_.pos(t),c=!1,removeEvent(_touchmove,document,h),_.isFunction(r)&&r.call(e,endPos.el,t)};addEvent("mouseover",e,function(t){e.css({cursor:"move"})}),addEvent("mouseout",e,function(t){e.css({cursor:"normal"})}),addEvent(_touchstar,e,o),addEvent(_touchmove,document,f),addEvent(_touchend,document,a);break;default:var p=function(o){_.isFunction(r)?r.call(e,e,o):_.isArray(r)&&r.forEach(function(t){t.call(e,e,o)}),n&&i.off(t,e)};addEvent(t,e,p)}},off:function(t,e,r){TAP===t?(removeEvent(_touchstar,e),removeEvent(_touchend,e)):removeEvent(t,e,r)}}}(),toucher=_.toucher=function(t){return new toucher.prototype.init(t)};toucher.prototype={constructor:toucher,init:function(t){var e=this;if(!t)return void(t===!1&&e.offEvent());var r=[],n=function(t){var i=_.query(t.el),o=t.type||"click",a=!!_.isUndefined(t.clear)||t.clear,s=t.listener||t.callback,c=t.once||!1;_.isElement(i)?("input"===i.nodeName.toLowerCase()&&o===TAP&&(o="click"),a&&e.clear({el:i,type:o}),r.push({type:o,el:i,listener:s,once:c})):_.isArray(i)&&i.forEach(function(e){n(_.clone(t,{el:e}))})};_.isArray(t)?t.forEach(function(t){n(t)}):n(t),e.onEvent(r)},onEvent:function(t){return t.forEach(function(t){Events.store(t),Events.on(t.type,t.el,t.listener,t.once)}),this},offEvent:function(t){return Events.filter(t).forEach(function(t){Events.off(t.type,t.el)}),this},clear:function(t){return this.offEvent(t)}},toucher.prototype.init.prototype=toucher.prototype;var walker=_.walker=function(t){return new walker.prototype.init(t)};walker.prototype={constructor:walker,ch:"",pos:0,line:0,col:0,max:0,text:"",escapee:{'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},init:function(t){if(_.isString(t))this.text=t;else if(_.isNumber(t))this.text=""+t;else{if(!_.isObject(t))throw{name:"input error",messasge:'string or {text:""} is required'};this.text=t.text||"",this.debug=t.debug||!1}this.max=this.text.length,this.line=0,this.col=0,this.pos=0,this.ch=this.peek()},parseTable:function(){this.table=[];for(var t,e=[];this.next();)t=this.until("|"),t&&e.push(t),("\n"===this.ch||this.pos>=this.max)&&(this.table.push(e),e=[]);return this.table},peek:function(t){var e=this.text.charAt(this.pos);if(t){e="";for(var r=0;r<=t;r++)e+=this.text.charAt(this.pos+r>=this.max?this.max:this.pos+r)}return e},eof:function(){return""===this.peek()},next:function(t){return t&&t!==this.ch&&error("Expected '"+t+"' instead of '"+this.ch+"'"),this.ch=this.text.charAt(this.pos++),"\n"===this.ch?(this.line++,this.col=0):this.col++,this.debug&&(this.token=this.peek(10)),this.ch},back:function(){return this.ch=this.text.charAt(this.pos--)},error:function(t){for(var e="",r=10;r--;)this.next(),e+=this.ch;var n={name:"SyntaxError",message:t,pos:this.pos,ch:this.ch,line:this.line,col:this.col,text:this.text,token:e};console.log(n)},info:function(){return{pos:this.pos,ch:this.ch,line:this.line,col:this.col,text:this.text}},until:function(t){var e="",r=this.ch;if(r===t)for(;r=this.next();){if(r===t)return this.back(),e;if("\n"===r){e="";break}e+=r}return e},json:function(){return this._parseJson()},_parseJson:function(){switch(this._skipWhite(),this.ch){case"{":return this._parseObj();case"[":return this._parseArr();case":":return this._parseJson();case'"':case"'":return this._parseStr();default:return/[\d\.-]/.test(this.ch)?this._parseNum():this._parseValue()}},_parseObj:function(){this._skipWhite();var t,e={};if("{"===this.ch)for(;this.next();){if(this._skipWhite(),"}"===this.ch)return this.next(),e;this.ch&&(t=this._parseKey(),Object.prototype.hasOwnProperty.call(e,t)&&(this.error("Duplicate key '"+t+"'"),console.log(e)),e[t]=this._parseJson())}return e},_parseArr:function(){this._skipWhite();var t=[];if("["===this.ch)for(;this.next();){if(this._skipWhite(),"]"===this.ch)return this.next(),t;if(this.ch){var e=this._parseJson();if(e&&(t.push(e),"]"===this.ch))return this.next(),t}}return t},_skipWhite:function(){for(;this.ch&&this.ch<=" ";)this.next()},_removeQuote:function(t){return t.replace(/(?:^"(.*)"$)|(?:^'(.*)'$)/,"$1$2")},_parseKey:function(){for(var t=this.ch;this.next();){if(":"===this.ch)return this.next(),this._removeQuote(t);t+=this.ch}},_parseStr:function(){this._skipWhite();var t="",e=this.ch;if(~"\"'".indexOf(e))for(;this.next();){if(e===this.ch)return this.next(),t;"\\"===this.ch&&(this.next(),this.escapee[this.ch]&&(t+=this.escapee[this.ch])),t+=this.ch}},_parseNum:function(){if(/[\d\.-]/.test(this.ch)){for(var t=this.ch;this.next();){if(~",}]".indexOf(this.ch))return t=+t;t+=this.ch}return t}},_parseValue:function(){for(var t=this.ch;this.next();){if(~",}]".indexOf(this.ch))return this._removeQuote(t);t+=this.ch}return t}},walker.prototype.init.prototype=walker.prototype;var debug=_.debug=function(t){return new debug.prototype.init(t)};debug.prototype={constructor:debug,init:function(t){var e=document.createElement("div");e.className="_console";var r=document.createElement("div");r.className="_console_handle",r.innerHTML="debug";var n=document.createElement("div");n.className="_console_log",e.appendChild(r),e.appendChild(n),_.$("body").appendChild(e),console.log=function(){var t=Array.prototype.slice.call(arguments);template({el:"._console_log",act:"append",template:'<div class="_item">{=result}</div>',data:{result:1===t.length?t[0]:t},callback:function(){this.el.query("._item").removeAttr("style").last().css({color:"red"}).scrollIntoView()}})},toucher([{el:"._console",type:"touchstart",callback:function(t,e){e.preventDefault(),e.stopPropagation()}},{el:"._console_handle",type:"tap",callback:function(t,e){var r=_.$("._console_log");_.isShow(r)?_.hide(r):_.show(r)}}])}},debug.prototype.init.prototype=debug.prototype;var cycle=_.cycle=function(){var t=Array.prototype.slice.call(arguments);return new cycle.prototype.init(t)};cycle.prototype={constructor:cycle,init:function(t){var e=t.length;if(this.index=0,this.values=[],_.isArray(t[0]))this.values=t[0];else if(_.isObject(t[0]))for(var r in t[0]){var n={};n[r]=t[0][r],this.values.push(n)}else this.values.push(t[0]);if(e>=2)if(_.isNumber(t[0]))for(var i=t[0],o=t[1],a=i;a<=o;a++)this.values.push(a);else this.index=t[1];3===e&&(this.text=t[2]),this.length=this.values.length},next:function(){return this.values[this.index=this.index+1>=this.length?0:this.index+1]},prev:function(){return this.values[this.index=this.index<=0?this.length-1:this.index-1]},current:function(){return this.values[this.index=this.index===-1?0:this.index]},val:function(){return this.current()},first:function(){return this.length>0?this.values[0]:null},last:function(){return this.length>0?this.values[this.length-1]:null},text:function(t){this.text=t},attr:function(t){for(var e in t)this[e]=t[e];return this}},cycle.prototype.init.prototype=cycle.prototype,_.sliderCycle=function(t){var e=t.min,r=t.max,n=t.step,i=t.value,o=[],a=0,s=e,c=0,h=0;for(n.toString().replace(/\d+(?:\.(\d+))?/,function(t,e){e&&(h=e.length)});s<=r;)o.push(s),s===i&&(c=a),s=+(s+n).toFixed(h),a++;return _.cycle(o,c).attr(t)},inBrowser&&function(){for(var t=0,e=["ms","moz","webkit","o"],r=0;r<e.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[e[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[r]+"CancelAnimationFrame"]||window[e[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,r){var n=+new Date,i=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+i)},i);return t=n+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var PIx2=2*Math.PI;_.rad=function(t){return t%=360,t*Math.PI/180},_.deg=function(t){return t*(180/Math.PI)},_.sin=function(t){return t%=360,Math.sin(t*Math.PI/180)},_.cos=function(t){return t%=360,Math.cos(t*Math.PI/180)},_.tan=function(t){return t%=360,Math.tan(t*Math.PI/180)},_.atan=function(t){return t%=360,Math.atan(t*Math.PI/180)},_.fibonacci=function(t){if(1===t)return[0];if(2===t)return[0,1];for(var e=[0,1],r=0;r<t-2;r++)e.push(e[r]+e[r+1]);return e};var _queue=_.queue=function(t){return new _queue.prototype.init(t)};_queue.prototype={constructor:_queue,init:function(t){this.dataStore=[],this.speeds={slow:600,fast:200,_default:400},t&&this.enqueue(t)},enqueue:function(t){this.dataStore.push(t)},dequeue:function(){return this.dataStore.shift()},exequeue:function(){var t=this.dequeue();t&&t.call(this,this.exequeue)},delay:function(t,e){var r=this;e=_.isNumber(e)?e:e in this.speeds?this.speeds[e]:this.speeds._default,this.enqueue(function(n){setTimeout(function(){t&&t(),n&&n.call(r)},e)}),r.timeout&&clearTimeout(r.timeout),r.timeout=setTimeout(function(){r.exequeue()},0)}},_queue.prototype.init.prototype=_queue.prototype;var Easing=_.Easing={ease:function(t){return t<=.5?2*t*t:t>.5?-2*t*t+4*t-1:void 0},easeIn:function(t){return t*t},ease2:function(t){return t<1/3?t*t:-2*t*t+4*t-1},easeOut:function(t){return Math.pow(t,.8)},collision:function(t){for(var e,r,n=1,i=20;n<i;n++)if(e=1-4/3*Math.pow(.5,n-1),r=1-4/3*Math.pow(.5,n),t>=e&&t<=r)return Math.pow(3*(t-(e+r)/2),2)+1-Math.pow(.25,n-1)},elastic:function(t){return-Math.pow(1/12,t)*Math.cos(2.5*Math.PI*t*t)+1},linear:function(t){return t},wave:function(t){return 1/12*Math.sin(5*Math.PI*t)+t},opposite:function(t){return Math.sqrt(2)/2*Math.sin(3*Math.PI/2*(t-.5))+.5}},_tween=_.tween=function(t){return new _tween.prototype.init(t)};_tween.prototype={constructor:_tween,init:function(t){this._start=t.start,this._end=t.to,this.callback=t.callback,this.duration=t.duration,this._repeat=t.repeat,this._yoyo=t.yoyo,this.type=t.type||"linear",this._deta={};for(var e in this._end)this._end.hasOwnProperty(e)&&_.isNumber(this._end[e])&&(this._deta[e]=this._end[e]-this._start[e]||0);this._delayTime=t.delay||0,this._startTime=+new Date,this._startTime+=this._delayTime,this.update()},calculate:function(t){var e=(t-this._startTime)/this.duration;e=0===this.duration||e>1?1:e;var r;if(_.isObject(this.type)){r={};for(var n in this._deta)this._deta.hasOwnProperty(n)&&(r[n]=Easing[this.type[n]||"linear"](e))}else r=Easing[this.type](e);if(this._repeat&&1===e&&(this._startTime=t,isFinite(this._repeat)&&this._repeat--,this._yoyo)){var i=this._start;this._start=this._end,this._end=i;for(var n in this._end)this._end.hasOwnProperty(n)&&(this._deta[n]=this._end[n]-this._start[n]||0)}var o={};for(var n in this._deta)if(this._deta.hasOwnProperty(n)){var a=_.isObject(r)?r[n]:r;o[n]=a*this._deta[n]+this._start[n]}return o},update:function(){var t=this,e=+new Date,r=this.calculate.call(this,e);e-this._startTime<=this.duration?(this.callback(r),setTimeout(function(){t.update.call(t)},17)):this.callback(r)}},_tween.prototype.init.prototype=_tween.prototype;var _vector=_.vector=function(t){return new _vector.prototype.init(t)};_vector.prototype={constructor:_vector,init:function(t){t=t||{},this.x=t.x||0,this.y=t.y||0,this.z=t.z||0},equal:function(t){return t.x===this.x&&t.y===this.y},clone:function(){return this.constructor({x:this.x,y:this.y,z:this.z})},neg:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},norm:function(){return this.constructor({x:-this.y,y:this.x})},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},scale:function(t){return this.x*=t,this.y*=t,this.z*=t,this},abs:function(t){if(_.isUndefined(t))return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);var e=this.abs();return 0===e?this.x=t:t!==e&&this.scale(t/e),this},deg:function(t){if(_.isUndefined(t))return this.radToDeg(Math.atan2(this.y,this.x));var e=this.abs();return this.x=e*Math.cos(this.degToRad(t)),this.y=e*Math.sin(this.degToRad(t)),this},rad:function(t){if(_.isUndefined(t))return Math.atan2(this.y,this.x);var e=this.abs();return this.x=e*Math.cos(t),this.y=e*Math.sin(t),this},mul:function(t){return this.x*t.x||0+this.y*t.y||0+this.z*t.z||0},ia:function(t){return Math.acos(this.mul(t)/(this.abs()*t.abs()))},isNorm:function(t){return 0===this.mul(t)},degToRad:function(t){return t*(Math.PI/180)},radToDeg:function(t){return t*(180/Math.PI)},rotate:function(t){var e=_.cos(t),r=_.sin(t),n=this.x,i=this.y,o=n*e-i*r,a=n*r+i*e;return this.x=o,this.y=a,this},cross:function(t){var e=this.x,r=this.y,n=this.z;return this.x=r*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-r*t.x,this},split:function(t){for(var e=[],r=1;r<=t;r++)e[e.length]=this.clone().scale(r/(t+1));return e},rotateXY:function(t,e){var r=_.cos(t),n=_.sin(t),i=_.cos(e),o=_.sin(e),a=this.x,s=this.y,c=this.z,h=s*n+c*r;return this.y=s*r-c*n,this.z=a*-o+h*i,this.x=a*i+h*o,this},pr:function(t){return t=t?t:300,t/(this.z+t)},proj:function(t){return t=t?t:this.pr(),this.x*=t,this.y*=t,this.z=0,this},toP:function(t){var e=this.deg(),r=this.abs();return _pointPolar({a:e,r:r,o:t||this})}},_vector.prototype.init.prototype=_vector.prototype;var _pointPolar=_.pointPolar=function(t){return new _pointPolar.prototype.init(t)};_pointPolar.prototype={constructor:_pointPolar,init:function(t){var e=this.a=t.a||0,r=this.r=t.r||0,n=this.o=t.o||{x:0,y:0},i=this.xy(r,e,n);this.x=i.x,this.y=i.y},xy:function(t,e,r){return{x:r.x+t*_.cos(e),y:r.y+t*_.sin(e)}},toV:function(t){return _vector(t?{x:t.x-this.x,y:t.y-this.y}:{x:this.x-this.o.x,y:this.y-this.o.y})},distance:function(t){return this.toV(t).abs()},dist:function(t){return this.distance(t)},transform:function(t){return this.constructor(_.extendOwn({},this,t))},clone:function(t){return this.transform(t)},slope:function(t){return(this.y-t.y)/(this.x-t.x)},mid:function(t){return this.toV(t).scale(.5).toP(this)},split:function(t,e){for(var r=[],n=1;n<=e;n++)r[r.length]=this.toV(t).scale(n/(e+1)).toP(this);return r},mirror:function(t,e){var r=this.toV(t);return e&&r.scale(e),r.toP(t)},translate:function(t,e){return this.toV(t).abs(e).toP(this)},trans:function(t,e){return this.translate(t,e)},vertical:function(t,e){return this.toV(t).norm().abs(e).toP(this)},norm:function(t,e){return this.vertical(t,e)},rotate:function(t){return this.clone({a:(this.a+t)%360})},rotateX:function(t){return this.rotateXY(t,0)},rotateY:function(t){return this.rotateXY(0,t)},rotateXY:function(t,e){return this.toV().rotateXY(t,e).proj().toP(this)},scale:function(t){return this.clone({r:this.r*t})},add:function(t){return this.x+=t.x,this.y+=t.y,this},proj:function(t,e){return this.toV(t).proj(e).toP(this)},pr:function(t,e){return this.toV(t).pr(e)}},_pointPolar.prototype.init.prototype=_pointPolar.prototype;var _point=_.point=function(t){return new _point.prototype.init(t)};_point.prototype={constructor:_point,init:function(t){this.x=t.x,this.y=t.y,this.r=t.r,this.color=t.color;var e=t.speed||1;this.vx=(2*Math.random()-1)*e,this.vy=(2*Math.random()-1)*e,this.left=t.left||0,this.right=t.right||t.width,this.top=t.top||0,this.bottom=t.bottom||t.height},move:function(){return this.x+=this.vx,this.y+=this.vy,(this.x<this.left||this.x>this.right)&&(this.vx*=-1),(this.y<this.top||this.y>this.bottom)&&(this.vy*=-1),this},clone:function(t){return this.constructor(_.extendOwn({},this,t))}},_point.prototype.init.prototype=_point.prototype;var _vertex=_.vertex=function(t){return new _vertex.prototype.init(t)};_vertex.prototype={constructor:_vertex,init:function(t){t&&(this.po=this.centerPoint(t),this.vs=this.vertices(t))},centerPoint:function(t){var e={x:t.x||0,y:t.y||0};return _pointPolar({o:e})},vertices:function(t){var e=t.group||t.shape,r=t.r||100,n=t.a||0,i=(t.x,t.y,t.rRatio||1),o=(t.aRatio||1,t.turns||1),a=t.num||3,s=this.po,c=t.rRatioType;switch(e){case"star":c="ac",i=[i,1/i];break;case"spiral":r=.01,o=30}for(var h,u=[],l=_.cycle(i||1),f=r,p=0;p<a*o;p++){switch(c){case"cv":f+=r*(l.next()-1);break;case"ac":f=0===p?r:1===p?r*l.val():f*l.next();break;default:if(_.isArray(i)){var d=i.length;f=r*i[p+1>d?p%d:p]}else f=r*Math.pow(i,p)}h=360*p/a+n,u[u.length]=s.clone({a:h,r:f})}return u},invertices:function(t){var t=t||this.vs,e=t.length;return!(e<2||t[0].dist(t[1])<10)&&t.map(function(r,n){return r.mid(t[n+1<e?n+1:0])})},regularVertices:function(t){for(var e=t.num,r=this.po,n=360/e,i=[p],o=0;o<e;o++)i.push(p=r.rotate(n));return i},transform:function(t){return this.vs.map(function(e){return e.transform(t)})},clone:function(t){return this.vs.map(function(e){return e.clone(t)})},rotate:function(t){return this.vs=this.vs.map(function(e){return e.rotate(t)}),this},rotateXY:function(t,e){return this.vs=this.vs.map(function(r){return r.rotateXY(t,e)}),this},add:function(t){return this.vs=this.vs.map(function(e){return e.add(t)}),this},intriangle:function(t){var e=this,r=[];return function n(t){var i=e.invertices(t);i&&(r.push(i),t.map(function(t,e){var r=[t,i[e],i[0===e?i.length-1:e-1]];n(r)}))}(t),r},spiral:function(t){for(var e=this.po||this.centerPoint(t),r=[e],n=t.turns||1,i=t.r,o=0;o<n;o+=2)[[i*o,0],[0,i*o],[-i*(o+1),0],[0,-i*(o+1)]].forEach(function(t){r.push(e.translateXY.apply(e,t))});return r}},_vertex.prototype.init.prototype=_vertex.prototype;var _shape=_.shape=function(t,e){return new _shape.prototype.init(t,e)};_shape.prototype={constructor:_shape,init:function(t,e){var r=this;if(t&&(this.draw=t,this.canvas=t.canvas,this.context=t.context),e){[{k:"line",num:2},{k:"triangle",num:3},{k:"square",num:4}].forEach(function(t){t.k===e.shape&&(e.shape="polygon",e.num=t.num)});var n=_.isUndefined(e.shape)?"polygon":e.shape,i=_.isUndefined(e.x)?this.canvas.width/2:e.x,o=_.isUndefined(e.y)?this.canvas.height/2:e.y,a=_.isUndefined(e.a)?0:e.a;i+=e.offsetX||0,o+=e.offsetY||0;var e=this.opt=_.clone(e,{shape:n,width:e.r,height:e.r,x:i,y:o,a:a});r.setup(e)}},setup:function(t){var t=t||this.opt,e=t.shape;return e in this?t.fractalMirror?this.fractalMirror(t):t.fractal?this.fractal(t):t.fractalIn?this.fractalIn(t):(this._vertex(t),t.vertexRotate?this.vertexRotate():t.vertexTransform?this.vertexTransform():this[e].call(this,t)):void console.log(NaN+e)},_vertex:function(t){var e=this.vertex=_.vertex(t);this.vs=e.vs,this.po=e.po},_calculatedAmount:function(t){var e=t.num,r=5,n=0;if(t.fractal)for(;r--;)n+=Math.pow(e,r+1);return n>1e4},fractal:function(t){var e=this;this.setup(_.clone(t,{fractal:!1}));var r=t.fractalRatio||.618,n=t.r*r,i=t.minR||5,o=t.fractalLevel||0,a=_.isUndefined(t.maxLevel)?5:t.maxLevel;o++;var s=!(o>=a||n<i);this.vs.forEach(function(r){var i=_.clone(t,{x:r.x,y:r.y,r:n,fractal:s,fractalLevel:o});e.setup(i)})},fractalIn:function(t){var e=this;this.setup(_.clone(t,{fractalIn:!1}));var r=t.fractalLevel||0,n=_.isUndefined(t.maxLevel)?5:t.maxLevel;if(r++,!(r>=n)){var i=this.vs;this.po;if(!(i.length<2)){var o=i[0].toV().add(i[1].toV()),t=_.clone(t,{r:o.abs(),
a:o.deg()},{fractalLevel:r});e.setup(t)}}},fractalMirror:function(t){this.setup(_.clone(t,{fractalMirror:!1}));var e=t.fractalLevel||0,r=_.isUndefined(t.maxLevel)?5:t.maxLevel;if(e++,!(e>=r)){var n=_.vertex(t),i=n.vs,o=n.po,a=t.fractalRatio||.618,s=t.minR||5;i.forEach(function(r,n){var i=o.mirror(r,a);if(!(i.r<s)){var c=_.clone(t,{r:i.r,x:i.x,y:i.y,a:i.a+180,fractalLevel:e});self.shape(c)}})}},color:function(t){if(t){var e=_color();this.opt.fill?this.opt.color=e.rgba():this.opt.color=e.rgb()}return this},regularPolygon:function(t){var e=_.vertex().regularVertices(t);this.draw.link(e,t)},spiral:function(t){var e=_.vertex().spiral(t);this.draw.link(e,t)},fibonacci:function(t){function e(t,e,r){var n=Math.PI,s=.5*Math.PI;if(e>2)switch(e%4){case 0:o=o+t-r,n=0,s=1.5*Math.PI;break;case 1:a=a-t+r,n=1.5*Math.PI,s=Math.PI;break;case 2:o=o-t+r,n=Math.PI,s=.5*Math.PI;break;case 3:a=a+t-r,n=.5*Math.PI,s=0}i.arc(o,a,r,n,s,!0)}var r=t.num,n=_.fibonacci(r),i=(t.group.sequence,this.context),o=t.x,a=t.y;t.r;this.draw.beginPath(t);for(var s=0;s<n.length;s++)s>=2&&e(n[s-1],s,n[s]);return this.draw.render(_.clone(t,{closed:!1})),this},vertices:function(t){var e=this,r=this.vs;r.forEach(function(r){e.circle(_.clone(t,{x:r.x,y:r.y,r:3,text:""}))})},text:function(t){var e=this.context,r=t.x,n=t.y,i=t.r||12,o=_.isUndefined(t.text)?t.num:t.text;e.fillStyle=t.color||"#000",e.font=i+"px Verdana";var a=e.measureText(o);e.fillText(o,r-a.width/2,n+i/2)},circle:function(t){var e=this.context,r=t.x,n=t.y,i=t.r||1,o=t.sa||0,a=t.ea||2*Math.PI;e.beginPath(),e.arc(r,n,i,o,a,!0),e.closePath(),this.draw.fillstroke(t);var s=t.text;if(!_.isUndefined(s)){e.fillStyle="#000",e.font="12px Verdana";var c=e.measureText(s);e.fillText(s,r-c.width/2,n+i/2)}return this},ball:function(t){var e=this.context;t.fill=!0;var r=t.x,n=t.y,i=t.r;e.beginPath(),e.arc(r,n,i,0,2*Math.PI),e.closePath(),this.draw.fillstroke(t)},ellipse:function(t){var e=this.context,r=t.x,n=t.y,i=t.r,o=t.a||2*i,a=t.b||i,i=o>a?o:a,s=o/i,c=a/i;return e.scale(s,c),e.beginPath(),e.moveTo((r+o)/s,n/c),e.arc(r/s,n/c,i,0,2*Math.PI),e.closePath(),this.draw.fillstroke(t),this},sector:function(t){var e,r=this.context,n=t.x,i=t.y,o=t.r,a=t.a,s=!0;return s?a-.5*Math.PI:e=a+.5*Math.PI,r.beginPath(),r.arc(n,i,o,a,e,s),r.closePath(),this.draw.fillstroke(t),this},ring:function(t){var e=this.context;this.draw.beginPath(t);var r=t.x,n=t.y,i=t.r,o=i*t.rRatio;return e.arc(r,n,i,0,PIx2,!1),e.moveTo(r+o,n),e.arc(r,n,o,PIx2,0,!0),this.draw.closePath(t),this.draw.fillstroke(t),this},heart:function(t){function e(t){t.beginPath(),t.arc(-1,0,1,Math.PI,0,!1),t.arc(1,0,1,Math.PI,0,!1),t.bezierCurveTo(1.9,1.2,.6,1.6,0,3),t.bezierCurveTo(-.6,1.6,-1.9,1.2,-2,0),t.closePath()}var r=this.context,n=t.r,i=t.a,o=t.x,a=t.y;return r.translate(o,a),r.rotate(_.rad(i)),r.scale(n,n),e(r),this.draw.fillstroke(t),this},ushape:function(t){},vshape:function(t){},polygon:function(t){return this.draw.link(this.vs,t)},rectangle:function(t){var e=this.context,r=t.r,n=2*r*_.cos(45),i=2*r*_.sin(45),o=t.x-n/2,a=t.y-i/2;this.draw.beginPath(t),e.rect(o,a,n,i),this.draw.closePath(t),this.draw.fillstroke(t)},diamond:function(t){return t.num=4,_.isNumber(t.rRatio)?t.rRatio=[t.rRatio,1/t.rRatio]:t.rRatio=[.5,2],t.rRatioType="ac",this.vs=_.vertex(t).vs,this.polygon(t)},star:function(t){return t.shape="star",this.vs=_.vertex(t).vs,this.polygon(t),this},pentagram:function(t){for(var e=t.num||5,r=t.r,n=t.ratio||3-4*Math.pow(_.sin(18),2),i=this.vs,o=[],a=0;a<e;a++){var s=i[a],c=s.clone({a:s.a+180/e,r:r/n});o.push(s),o.push(c)}return this.draw.link(o,t)},cross:function(t){for(var e=t.num,r=[],n=this.vertex,t=_.clone(t,{num:2*t.num}),i=n.vertices(t),o=0;o<t.num;o++)r.push([i[o],i[o+e]]);return this.draw.linkGroup(r,t)},rose:function(t){var e=this,r=this.vertex,n=r.vs,i=[n],o=0,a=t.turns||3;return function s(e){if(!(o>=a)){var n=t.r/Math.pow(2,++o),c=r.clone({r:n});i.push(c),e.map(function(t,e){var r=[t,c[e+1===c.length?0:e+1]];i.push(r)}),s(c)}}(n),e.draw.linkGroup(i,t)},sunflower:function(t){for(var e=t.interval||2,r=[],n=this.vs,i=n.length,o=0;o<i;o++){var a=[];a.push(n[o]),a.push(n[(o+e)%i]),r.push(a)}return this.draw.linkGroup(r,t)},sierpinski:function(t){var e=this,r=this.vertex,n=r.vs,i=[n];return function o(t){var e=r.invertices(t);e&&(i.push(e),t.map(function(t,r){var n=[t,e[r],e[0===r?e.length-1:r-1]];o(n)}))}(n),e.draw.linkGroup(i,t)},carpet:function(t){var e=this,r=this.vertex,n=r.vs,i=[n];t.num;return function o(t){var e=t.r;if(!(e<5)){var r=_.vertex(t),n=e/3,a=r.clone({r:n});i.push(a);var s=2*e/3,c=r.clone({r:s}),h=[],u=c.length;c.forEach(function(t,e){h.push(t),h.push(t.mid(c[e+1===u?0:e+1]))}),h.forEach(function(e){var r=_.clone(t,{r:n,x:e.x,y:e.y});o(r)})}}(t),e.draw.linkGroup(i,t)},inpolygon:function(t){var e=this,r=this.vertex,n=r.vs,i=[n];return function o(t){var e=r.invertices(t);e&&(i.push(e),o(e))}(n),e.draw.linkGroup(i,t)},axialMirror:function(t){var e=this.vertex,r=e.vs,n=e.po,i=[r],o=(t.a,t.num),a=t.r,s=2*a*_.cos(180/o);return r.forEach(function(t,r){var a=n.clone({a:t.a+180/o,r:s}),c=e.clone({o:{x:a.x,y:a.y}});i.push(c)}),this.draw.linkGroup(i,t)},comb:function(t){var e=[];t.num=6;var r=this.vertex,n=r.vs,i=r.po;e.push(n);var o=(t.a,t.num),a=t.r,s=function(t){var s=2*t*a*_.cos(180/o);n.forEach(function(t,n){var a=i.clone({a:t.a+180/o,r:s}),c=r.clone({o:{x:a.x,y:a.y}});e.push(c)})},c=function(t){var o=2*t*a+a;n.forEach(function(t,n){var a=i.clone({a:t.a,r:o}),s=r.clone({o:{x:a.x,y:a.y}});e.push(s)})};return[1,2,3].forEach(function(t){s(t),c(t)}),this.draw.linkGroup(e,t)},reuleaux:function(t){var e=this,r=this.vertex,n=r.vs;this.draw.link(n,t);var i=2*t.r*_.sin(180/t.num);n.forEach(function(r){e.circle(_.clone(t,{x:r.x,y:r.y,r:i,text:""}))})},beads:function(t){var e=this,r=this.vs,n=r.length,i=t.r*_.sin(180/t.num);r.forEach(function(o,a){var s=o.mid(r[a+1<n?a+1:0]);e.circle(_.clone(t,{x:s.x,y:s.y,r:i,text:""}))}),this.draw.link(r,t)},kohn:function(t){var e=this.vs,r=function(t,e){var n=t.split(e,2),i=n[0].dist(n[1])/Math.sqrt(2),o=n[0].mid(n[1]),a=o.vertical(n[1],i);n.splice(1,0,a);var s=[t].concat(n);if(s.push(e),i<10)return s;var c=[],h=s.length;return s.forEach(function(t,e){if(e+1<h){var n=r(t,s[e+1]);c=e===h-2?c.concat(n):c.concat(n.slice(0,n.length-1))}}),c},n=[],i=e.length;e.forEach(function(t,o){var a=e[o+1===i?0:o+1];n.push(r(t,a))}),this.draw.linkGroup(n,t)},ray:function(t){var e=this.vs,r=e.length,n=this.po,i=[];if(t.fillInterval)for(var o=0;o<r;o+=2)i.push([n,e[o],e[o+1===r?0:o+1]]);else i=e.map(function(t,e){return[n,t]}),t.fill&&i.push(e);return this.draw.linkGroup(i,t)},rayFractal:function(t){var e=_.vertex(t),r=e.vs,n=(r.length,e.po,this),i=function(t){var e=_.vertex(t),r=e.vs,i=r.length,o=e.po,a=[];if(t.fillInterval)for(var s=0;s<i;s+=2)a.push([o,r[s],r[s+1===i?0:s+1]]);else r.forEach(function(t,e){a.push([o,t])}),t.fill&&a.push(r);n.draw.linkGroup(a,t)};r.forEach(function(e){i(_.clone(t,{x:e.x,y:e.y}))})},pie:function(t){var e=this.vertex,r=e.vs,n=r.length,i=this.po,o=this.context;o.beginPath();var a=2;r.forEach(function(e,s){var c=r[s+a-1>=n?s+a-1-n:s+a-1];s%a===0&&o.arc(i.x,i.y,t.r,_.rad(c.a),_.rad(e.a),!0)}),o.closePath(),this.draw.render(t,r)},sun:function(t){var e=this.vertex,r=e.vs,n=r.length,i=e.po;if(!(n<3)){var o=r.map(function(t,e){var o=r[e+1===n?0:e+1];return t.toV().add(o.toV()).toP(i)}),a=[];r.forEach(function(t,e){a.push(t),a.push(o[e])}),this.draw.link(r.concat(a),t)}},windmill:function(t){var e=this.vertex,r=e.vs,n=r.length;e.po;if(!(n<3)){var i=r.map(function(t,e){var i,o;return e+1===n?(i=r[0],o=r[1]):e+2===n?(i=r[e+1],o=r[0]):(i=r[e+1],o=r[e+2]),t.toV(i).add(t.toV(o)).toP(t)}),o=[];r.forEach(function(t,e){o.push(t),o.push(i[e])}),this.draw.link(r.concat(o),t)}},cornercurve:function(t){var e=this.vertex,r=e.vs,n=r.length,i=this.context;i.beginPath();var o=r.map(function(t,e){var i=r[e+1===n?0:e+1];return t.mid(i)});o.forEach(function(t,e){var a=o[e+1===n?0:e+1],s=r[e+1===n?0:e+1];i.moveTo(t.x,t.y),i.quadraticCurveTo(s.x,s.y,a.x,a.y)}),this.draw.render(t,r)}},_shape.prototype.init.prototype=_shape.prototype;var _shapeGroup=_.group=function(t,e){return new _shapeGroup.prototype.init(t,e)};_shapeGroup.prototype={constructor:_shapeGroup,init:function(t,e){this.draw=t,this.context=t.context,this.canvas=t.canvas;var r=e.shape.r,n=e.group.colorful,i=_.isUndefined(e.group.x)?this.canvas.width/2:e.group.x,o=_.isUndefined(e.group.y)?this.canvas.height/2:e.group.y,a=r,s=r;e.group&&~["mirror","surround"].indexOf(e.group.group)&&(a=e.group.sr+r,s=e.group.sr+r),_.isUndefined(e.group.a)&&(e.group.a=0);var c=[],h=e.group.interval||1,u=_.color(),l=e.group.num||360/h;switch(n){case"circle":c=u.circle(l);break;case"gradient":c=u.tween(u.light(),u.dark(),l);break;case"singleGradient":c=u.tween(u.dark(),"#ffffff",l);break;case"random":for(var f=0;f<l;f++)c[c.length]=u.hex();break;case"solid":}e.group=_.clone(e.group,{width:a,height:s,x:i,y:o,colorArr:c}),this.opt=e,this.setup()},shape:function(t){return this.draw.shape(t)},color:function(t){var e=t.group.colorful,r=t.shape.fill,n={};return e&&(n.color=r?_.color().rgba():_.color().rgb()),n},setup:function(t){var t=t||this.opt;if(t.group){var e=this.vertex=_.vertex(t.group);return this.vs=e.vs,this.po=e.po,this.groups=this[t.group.group](t)}return this.shape(t.shape)},polygon:function(t,e){var r=this,n=e||this.vs,i=this.po,o=n.length,a=_.vertex(t.shape),s=t.shape.a||0,c=[],h=t.group.sequence;switch(h){case"clockwise":break;case"anticlockwise":n.reverse();break;case"shuffle":n.shuffle()}return n.map(function(e,h){if(t.shape=_.clone(t.shape,{x:e.x,y:e.y,easing:!1}),"solid"!==t.group.colorful){var u=t.group.colorArr[h];t.shape=_.clone(t.shape,{color:u,lineColor:u,fillColor:u})}t.group.rotation&&(t.shape=_.clone(t.shape,{a:(s+360*h/o)%360}));var l,f;if(t.group.animate&&"none"===t.group.easing?(t.shape.delay=0!==h&&t.group.animationInterval,l=r.shape(t.shape),f=a.clone({o:{x:e.x,y:e.y}})):(l=r.shape(t.shape),f=l.vs),t.group.showRadius&&r.draw.link([i,e],t.group),t.group.link)for(var p=h;p<o-1;p++)r.draw.link([e,n[p+1]],t.group);if(t.group.neighborLink&&r.draw.link([e,n[h+1===o?0:h+1]]),t.group.vertexLink){var d;0===h?c.push(f):h+1<o?(d=c.pop(),f.forEach(function(e,n){r.draw.link([e,d[n]],t.group)})):h+1===o&&c.forEach(function(e){f.forEach(function(n,i){r.draw.link([n,e[i]],t.group)})}),c.push(f)}return t.group.identifierCenter&&r.draw.point({x:e.x,y:e.y,text:h}),t.group.conic&&f.forEach(function(e){r.draw.link([i,e],t.group)}),l})},sudoku:function(t){var e=_.vertex(_.clone(t.group,{num:8,rRatio:[1,Math.sqrt(2)],rRatioType:"default"})),r=[e.po].concat(e.vs);return t.group.rotation=!1,this.polygon(t,r)},fractal:function(t){var e=this,r={x:t.group.x,y:t.group.y},n=_.vertex(_.clone(t.shape,r)),i=n.vs;i.forEach(function(r){t.shape=_.clone(t.shape,{x:r.x,y:r.y}),e.shape(t.shape)})},cone:function(t){var e=this,r=this.vs,n=this.po,i=(r.length,[]);r.forEach(function(r){t.shape=_.clone(t.shape,{x:r.x,y:r.y});var o=e.shape(t.shape),a=o.vs;a.forEach(function(t){i.push([t,n])})}),this.draw.linkGroup(i,t.shape)},pillar:function(t){t.group.num=2,t.group.vertexLink=!0;var e=this.vertex=_.vertex(t.group);return this.vs=e.vs,this.po=e.po,this.polygon(t)},ring:function(t){this.shape(t.shape);var e=.618*t.shape.r;return this.shape(_.clone(t.shape,{r:e})),this},surround:function(t){var e=this,r=t.shape.r,n=t.group.rotation,i=t.group.interval||1,o=t.group.spiral,a=t.group.x,s=t.group.y,c=t.group.r;_.isUndefined(c)&&(c=r,r/=3);var h,u,l=t.group.sequence,f="clockwise"===l,p=t.group.a||0;f?(h=p+360,u=p,o&&(h*=o)):(h=p,u=p+360,o&&(u*=o));var d=h,v=t.group.animationInterval||5,g=0;return function m(){if(!(r<5)){if(f){if(d<=u)return;d-=i,o&&(r=r*d/360/o)}else{if(d>=u)return;d+=i,o&&(r=r*(u-d)/360/o)}n&&(t.shape.a=d);var h={x:a+c*_.sin(d),y:s+c*_.cos(d),r:r};t.group.colorArr.length>g&&(h.color=t.group.colorArr[g++]),t.shape=_.clone(t.shape,h),e.shape(t.shape),t.group.showRadius&&e.draw.link([{x:a,y:s},{x:t.shape.x,y:t.shape.y}]),t.group.animate?setTimeout(m,v):m()}}(),t.group.showCenter&&e.draw.shape({shape:"circle",r:3,x:a,y:s,color:t.group.colorArr[0],fill:!0}),e},concentric:function(t){var e=this,r=t.shape.r,n=t.group.interval||1,i=t.group.animationInterval||5;return function o(){r<=0||(t.shape=_.clone(t.shape,e.color(t),{r:r}),e.shape(t.shape),r-=n,t.group.animate?setTimeout(o,i):o())}(),e},excircle:function(t){return this.shape(t.shape),t.shape=_.clone(t.shape,{shape:"circle",text:""}),this.shape(t.shape),this},repeat:function(t){var e=this,r=this.canvas,n=r.width,i=r.height,o=t.group.interval||t.shape.r,a=n%o,s=i%o,c=t.group.animate,h=t.group.animationInterval||5,u=t.group.sequence,l="clockwise"===u,f=t.group.rotation,p=t.group.a||0,d=o+s/2,v=o+a/2,g=n-o-a/2;t.shape.y=d,l?t.shape.x=v:t.shape.x=g,f&&(t.shape.a=p);var m=0;return function y(){if(l){if(t.shape.x>n)return;t.shape.y>i&&(t.shape.y=d,t.shape.x+=2*o)}else{if(t.shape.x<o)return;t.shape.y>i&&(t.shape.y=d,t.shape.x-=2*o)}t.group.colorArr.length>m&&(t.shape.color=t.group.colorArr[m++]),t.shape=_.clone(t.shape),e.shape.call(e,t.shape),t.shape.y+=2*o,c?setTimeout(y,h):y()}(),e}},_shapeGroup.prototype.init.prototype=_shapeGroup.prototype;var _motion=_.motion=function(t,e){return new _motion.prototype.init(t,e)};_motion.prototype={constructor:_motion,init:function(t,e){this.draw=t,this.motion=e.motion.motion||"move",this.link=e.motion.link,this.shadow=e.motion.shadow;var r=e.motion.speed||1,n=e.motion.zoomSpeed||1,i=e.motion.num||1,o=e.motion.colorful,a=e.motion.bounce,s=e.motion.click,c=this.draw.width,h=this.draw.height;this.groups=[],this.a=0,this.r=e.motion.r||100,this.centerX=c/2,this.centerY=h/2;var u=!!_.isUndefined(e.motion.follow)||e.motion.follow,l=function(t){return _.clone(t,{vx:(2*Math.random()-1)*r,vy:(2*Math.random()-1)*r,bounce:a,speed:r,zoomState:"in",followSpeed:.01+.04*Math.random(),follow:u,click:s,mass:t.r*t.r,top:0,left:0,right:c,bottom:h,animate:!1,lightState:1,zoomSpeed:n})};if(_.isArray(e.shape))e.shape.forEach(function(e){e=l(e);var r=t.shape(e);r.color(o),this.groups[this.groups.length]=r});else for(var f=0;f<i;f++){e.id=f;var p;e.group?(e.group=l(e.group),p=t.group(e)):(e.shape=l(e.shape),p=t.shape(e.shape),p.color(o)),this.groups[this.groups.length]=p}this.len=this.groups.length,this.setup()},setup:function(){var t=this,e=t.groups,r=e.length,n=t.motion;t.shadow?t.draw.shadow():t.draw.clear(),e.forEach(function(i,o){var a=i.opt.group||i.opt;if(n.split("_").forEach(function(e){t[e]&&t[e](a),t.follow(a)}),i.setup&&i.setup(),t.link)for(var s=o;s<r-1;s++){var c=e[s+1],h=i.opt.group?[i.opt.group,c.opt.group]:[i.opt,c.opt];t.draw.link(h)}}),t.draw.canvas.callback&&t.draw.canvas.callback.call(t.draw.context,t.draw.context),t.id=inBrowser?requestAnimationFrame(t.setup.bind(t)):setTimeout(t.setup.bind(t),17)},stop:function(){inBrowser&&this.id?cancelAnimationFrame(this.id):clearTimeout(this.id)},follow:function(t){var e=this.draw.mouse;if(~["circle","ellipse"].indexOf(this.motion)){var r=this;if(t.follow&&e){var n=e.x-r.centerX,i=e.y-r.centerY;r.centerX+=n*t.followSpeed,r.centerY+=i*t.followSpeed}else t.click&&e&&(r.centerX=e.x,r.centerY=e.y)}else if(t.follow&&e){var n=e.x-t.x,i=e.y-t.y;t.x+=n*t.followSpeed,t.y+=i*t.followSpeed}else t.click&&e&&(t.x=e.x,t.y=e.y)},move:function(t){t.x+=t.vx||1,t.y+=t.vy||1,this.bounce(t)},sineMove:function(t){var e=this;t.x+=t.vx>0?1:-1,t.y+=_.sin(e.a)*e.r*(t.vy>0?1:-1),e.a+=t.speed,this.bounce(t)},bounce:function(t){t.bounce?t.x<t.left+t.width?(t.x=t.width,t.vx=-t.vx):t.y<t.top+t.height?(t.y=t.height,t.vy=-t.vy):t.x>t.right-t.width?(t.x=t.right-t.width,t.vx=-t.vx):t.y>t.bottom-t.height&&(t.y=t.bottom-t.height,t.vy=-t.vy):t.vx<0&&t.x<t.left-t.width?t.x=t.right+t.r:t.vy<0&&t.y<t.top-t.height?t.y=t.bottom+t.r:t.vx>0&&t.x>t.right+t.width?t.x=t.left-t.r:t.vy>0&&t.y>t.bottom+t.height&&(t.y=t.top-t.r)},collide:function(t,e){var r=t.x-e.x,n=t.y-e.y,i=Math.sqrt(r*r+n*n);if(i<e.r+t.r){var o=Math.atan2(n,r),a=Math.sin(o),s=Math.cos(o),c=0,h=0,u=r*s+n*a,l=n*s-r*a,f=e.vx*s+e.vy*a,p=e.vy*s-e.vx*a,d=t.vx*s+t.vy*a,v=t.vy*s-t.vx*a,g=f-d;f=((e.mass-t.mass)*f+2*t.mass*d)/(e.mass+t.mass),d=g+f,c+=f,u+=d;var m=c*s-h*a,y=h*s+c*a,x=u*s-l*a,w=l*s+u*a;t.x=e.x+x,t.y=e.y+w,e.x=e.x+m,e.y=e.y+y,e.vx=f*s-p*a,e.vy=p*s+f*a,t.vx=d*s-v*a,t.vy=v*s+d*a}},transform:function(t){t.num+=t.speed},rotate:function(t){t.a+=t.speed},jiggle:function(t){t.x+=2*Math.random()-1,t.y+=2*Math.random()-1,this.bounce(t)},"float":function(t){var e=2*Math.random()-1;t.vx+=e,t.vy-=e,t.x+=t.vx||1,t.y+=t.vy||1,this.bounce(t)},curve:function(t){t.x+=t.vx||1,t.y+=t.vy||1,t.vy+=.01*t.vx*t.vx,this.bounce(t)},gravitate:function(t){t.vy+=.22,t.vx*=.998,t.y>t.bottom-t.height&&(t.vy*=.96),t.bounce=!0,this.move(t)},zoom:function(t){var e=t.minR||1,r=t.maxR||t.right/2,n=t.zoomSpeed||t.speed||1;t.r>=r?t.zoomState="out":t.r<=e&&(t.zoomState="in"),"in"===t.zoomState?t.r+=n:t.r-=n},zoomin:function(t){t.r+=t.speed||1},zoomout:function(t){t.r-=t.speed||1},circle:function(t){var e=this;t.x=e.centerX+_.sin(e.a)*e.r,t.y=e.centerY+_.cos(e.a)*e.r,e.a+=.1*t.speed},spiral:function(t){var e=this;this.circle(t),e.r+=e.swell||1,t.x+t.r>t.right||t.y+t.r>t.bottom?e.swell=-1:e.r<1&&(e.swell=1)},ellipse:function(t){var e=this;t.x=e.centerX+Math.sin(e.a)*e.r,t.y=e.centerY+Math.cos(e.a)*e.r*2,e.a+=t.speed},light:function(t){t.shadowBlur>=20?self.lightState=-1:t.shadowBlur<=0&&(self.lightState=1),t.shadowBlur+=t.speed*self.lightState},throbLight:function(t){var e=t.minR||1,r=t.maxR||t.right/2,n=t.maxShadowBlur||10,i=t.minShadowBlur||0,o=t.speed||1,a=o*(n-i)/(r-e);t.r>=r?(t.zoomState="out",t.shadowBlur=n):t.r<=e&&(t.zoomState="in",t.shadowBlur=i),"in"===t.zoomState?(t.r+=o,t.shadowBlur+=a):(t.r-=o,t.shadowBlur-=a)}},_motion.prototype.init.prototype=_motion.prototype;var _track=_.track=function(t,e){return new _track.prototype.init(t,e)};_track.prototype={constructor:_track,init:function(t,e){this.draw=t,this.delay=t.delay.bind(t),this.point=t.point.bind(t),this.width=t.width,this.height=t.height;var r=e.shape||"circle";this[r]&&this[r](e)},polygon:function(t){function e(t){r.point({x:t.x,y:t.y,r:1,color:c})}var r=this,n=_.vertex(t),i=n.vs,o=i.length,a=t.delay||50,s=t.animate||t.delay,c=t.color||"black";i.forEach(function(t,n){var c=i[n+1==o?0:n+1],h=t.dist(c),u=[t].concat(t.split(c,h/10<<0||1));u.forEach(function(t){s?r.delay(function(){e(t)},a):e(t)})})},circle:function(t){function e(){n=n.rotate(1),r.point({x:n.x,y:n.y,r:1,color:i})}for(var r=this,n=_.pointPolar(_.extend({r:100,a:0,o:{x:this.width/2,y:this.height/2}},t)),i=t.color||"black",o=t.delay||10,a=t.animate||t.delay,s=0;s<360;s++)a?this.delay(e,o):e()},spiro:function(t){function e(){n=n.rotate(1);var t=f*n.a%360,e=_.pointPolar({r:o*a,a:t*s,o:{x:n.x,y:n.y}});r.point({x:e.x,y:e.y,r:1,color:u})}for(var r=this,n=_.pointPolar(_.extend({r:50,a:0,o:{x:this.width/2,y:this.height/2}},t)),i=t.r||t.r1||50,o=t.r2||50,a=t.rRatio||1,s=t.aRatio||1,c=t.delay||10,h=t.animate||t.delay,u=t.color||"black",l=t.turns||1,f=t.k||1+i/o,p=0;p<360*l;p++)h?this.delay(e,c):e()},sine:function(t){function e(){n=n.rotate(1);var t=u*n.a%360,e=_.pointPolar({r:h*(1+_.sin(t)),a:n.a,o:{x:n.x,y:n.y}});r.point({x:e.x,y:e.y,r:1,color:a})}for(var r=this,n=_.pointPolar(_.extend({r:100,a:0,o:{x:this.width/2,y:this.height/2}},t)),i=t.delay||10,o=t.animate||t.delay,a=t.color||"black",s=t.turns||1,c=t.r||t.r1||50,h=t.r2||50,u=t.k||1+c/h,l=0;l<360*s;l++)o?this.delay(e,i):e()}},_track.prototype.init.prototype=_track.prototype;var _slider=_.slider=function(t,e){return new _slider.prototype.init(t,e)};_slider.prototype={constructor:_slider,init:function(t,e){var r=this;this.draw=t,this.context=t.context;var n=t.width;this.canvas=t.canvas,this.pasue=!1,e=e||{},this.x=e.x||30,this.y=e.y||10,this.height=e.height||20,this.width=e.width||n-2*this.x,this.max=e.max||100,this.min=e.min||0;var i=this.progess=e.progess||0,o=this.color=e.color||"#000";this.callback=e.callback||function(t){r.render(t,o)},this.render(i,o),this.addEvent()},render:function(t,e){var r=this,n=this.context,i=this.x,o=this.y,a=this.height,s=this.width,c=this.max;this.progess=t,n.beginPath(),r.draw.setFillStyle(n,"#dedede"),n.rect(i,o,s,a),n.fill(),n.beginPath(),r.draw.setFillStyle(n,e),n.rect(i,o,s*t/c,a),n.fill(),n.beginPath(),r.draw.setFillStyle(n,"#fff"),n.rect(0,o,i,a),n.fill(),r.draw.text({x:i-18,y:o+a/2,text:t,r:12})},addEvent:function(){var t=this,e=this.x,r=this.y,n=this.height,o=this.width,a=this.max,s=(this.min,!1);toucher([{el:t.canvas,type:_touchstar,callback:function(c,h){var u=_.pos(h);u.y<r+n&&u.y>r?(t.pasue=!0,i=a*(u.x-e)/o<<0,i=_.between(0,a,i),t.callback&&t.callback(i),s=!0):t.pasue=!t.pasue}},{el:t.canvas,type:_touchmove,callback:function(r,n){var c=_.pos(n);s&&(t.pasue=!0,i=a*(c.x-e)/o<<0,i=_.between(0,a,i),t.callback&&t.callback(i))}},{el:t.canvas,type:_touchend,callback:function(t,e){s=!1}}])},run:function(){var t=this,e=this.max,r=this.color,n=this.progess;t.draw.loop(function(){t.pasue?n=t.progess:(t.render(n++,r),n%=e)},200)}},_slider.prototype.init.prototype=_slider.prototype;var _draw=_.draw=function(t,e){return new _draw.prototype.init(t,e)};_draw.prototype={constructor:_draw,init:function(t,e){var r=this;if(e)this.canvas=e,this.context=inBrowser?this.canvas.getContext("2d"):e.context;else if(inBrowser){if(t.el){var n=_.$(t.el);"canvas"===n.nodeName.toLowerCase()?this.canvas=n:(this.canvas=document.createElement("canvas"),n.appendChild(this.canvas))}else t.canvasid?(this.canvas=_.$("#"+t.canvasid),0===this.canvas.length&&(this.canvas=document.createElement("canvas"),this.canvas.id=t.canvasid)):t.container||t.containerid?(this.container=t.container?_.$(t.container):t.containerid?_.$("#"+t.containerid):document.documentElement,0===this.container.length?console.log("not found container:"+t.container):0===this.container.$("canvas").length?(this.canvas=document.createElement("canvas"),this.container.appendChild(this.canvas)):this.canvas=this.container.$("canvas")):this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");var i=!1,o=function(t,e){var n=_.pos(t),o=_.pos(e),a=r.mouse={x:o.x-n.x,y:o.y-n.y};r.opt&&(r.opt.motion||(r.opt.shape.begin&&r.clear(),r.opt.shape&&(r.opt.shape=_.extend(r.opt.shape,{x:a.x,y:a.y})),r.opt.group&&(r.opt.group=_.extend(r.opt.group,{x:a.x,y:a.y})),r.setup.call(r,r.opt))),i=!0},a=function(t,e){if(i){var n=_.pos(t),o=_.pos(e);r.mouse={x:o.x-n.x,y:o.y-n.y}}},s=function(t,e){i=!1};toucher([{el:this.canvas,type:"touchstart",callback:function(t,e){o(t,e)}},{el:this.canvas,type:"touchmove",callback:function(t,e){a(t,e)}},{el:this.canvas,type:"mousedown",callback:function(t,e){o(t,e)}},{el:this.canvas,type:"mousemove",callback:function(t,e){a(t,e)}},{el:this.canvas,type:"mouseup",callback:function(t,e){s(t,e)}}])}if(_.isObject(t)){this.options=t,t.fullscreen?this.fullscreen():this.size(t);var c={};[{k:"color",v:"background-color"},{k:"color",v:"background"},{k:"src",v:"background-image"},{k:"size",v:"background-size"},{k:"position",v:"background-position"},{k:"repeat",v:"background-repeat"}].forEach(function(e){e.v in t&&(c[e.k]=t[e.v])}),this.background(c),this.callback=t.callback;var h=_queue();this.delay=function(t,e){h.delay(t,e)}}},size:function(t){var e=this,r=this.container||document.documentElement,n=t.scale||1,i={width:r.clientWidth,height:r.clientHeight},o=t.ratio;return _.isString(o)?~o.indexOf(":")?o.replace(/(\d+):(\d+)/,function(t,e,r){i.height=i.width*r/e}):isNaN(parseFloat(o))||(i.height=i.width*parseFloat(o)):_.isNumber(o)&&(i.height=i.width*o),["width","height"].forEach(function(r){e[r]=e.canvas[r]=(r in t?t[r]:i[r])*n}),this.o={x:this.width/2,y:this.height/2},this},fullscreen:function(){return this.size({ratio:"fullscreen"})},background:function(t){var e=this,r=e.canvas,n=e.context,i=t.src,o=t.size,a=t.position,s=t.repeat,c=t.color,h=t.callback;return c&&(e.setFillStyle(c),n.fillRect(0,0,r.width,r.height)),i&&_.loadImg(i,function(t){var i=t.width,c=t.height,u=r.width,l=r.height;switch(o){case"cover":var f=_.max(u/i,l/c),p=i*f,d=c*f;if("center"===a){var v=f<=1?(u-p)/2:-(u-p)/2,g=f<=1?(l-d)/2:-(l-d)/2;n.drawImage(t,v,g,p,d)}else n.drawImage(t,0,0,p,d);break;case"contain":var f=_.min(u/i,l/c),p=i*f,d=c*f;if("center"===a){var v=(u-p)/2,g=(l-d)/2;n.drawImage(t,v,g,p,d)}else n.drawImage(t,0,0,p,d);"repeat"===s&&_.zipImg({img:t,zoom:f,callback:function(){var t=n.createPattern(this,"repeat");e.setFillStyle(t),n.fillRect(0,0,u,l),n.fill()}});break;case"stretch":n.drawImage(t,0,0,u,l);break;case"auto":n.drawImage(t,0,0);break;default:n.drawImage(t,0,0)}h&&h()}),this},toImage:function(){return this.canvas.toDataURL("image/jpeg")},toButton:function(t){return this.toElement({className:"btn",type:t})},toElement:function(t){var e=t.tag||t.nodeName||"div",r=document.createElement(e);switch(r.className=t["class"]||t.className,t.type){case"img":var n=document.createElement("img");n.src=this.toImage(),r.appendChild(n);break;case"background":r.style.backgroundImage="url("+this.toImage()+")";break;case"canvas":var i=this.canvas,o=_.draw(this.options),a=this.context.getImageData(0,0,i.width,i.height);o.context.putImageData(a,0,0),r.appendChild(o.canvas);break;default:r.appendChild(this.canvas)}return r},save:function(){return this.context.save(),this},restore:function(){return this.context.restore(),this},setFillStyle:function(t,e){e=e||"#000000",t.fillStyle=e,t.setFillStyle&&t.setFillStyle(e)},setStrokeStyle:function(t,e){e=e||"#000000",t.strokeStyle=e,t.setStrokeStyle&&t.setStrokeStyle(e)},setLineWidth:function(t,e){var e=_.isUndefined(e)?.5:e;t.lineWidth=e,t.setLineWidth&&t.setLineWidth(e)},setShadowBlur:function(t,e){var e=_.isUndefined(e)?10:e;t.shadowBlur=e,t.setShadowBlur&&t.setShadowBlur(e),t.shadowColor="black"},setShadowColor:function(t,e){var e=_.isUndefined(e)?10:e;t.shadowColor=e,t.setShadowColor&&t.setShadowColor(e)},setLineJoin:function(t,e){e=e||"miter",t.lineJoin=e,t.setLineJoin&&t.setLineJoin(e)},setGlobalAlpha:function(t,e){e=e||1,t.globalAlpha=e,t.setGlobalAlpha&&t.setGlobalAlpha(e)},setGlobalCompositeOperation:function(t,e){e=e||"source-over",t.globalCompositeOperation=e,t.setGlobalCompositeOperation&&t.setGlobalCompositeOperation(e)},set:function(t){if(t){var e=this.context;t.randomColor&&(t.color=_.color().rgba()),this.setLineJoin(e,t.lineJoin),this.setLineWidth(e,t.lineWidth),this.setStrokeStyle(e,t.lineColor||t.color),t.shadowBlur&&this.setShadowBlur(e,t.shadowBlur),t.shadowColor&&this.setShadowColor(e,t.shadowColor),this.setFillStyle(e,t.color)}return this},fill:function(t){return t&&t.fill&&this.context.fill(),this},stroke:function(t){return t&&0===t.lineWidth?this:(this.context.stroke(),this)},fillstroke:function(t){return this.fill(t).stroke(t)},render:function(t,e){return this.fillstroke(t),t&&(t.showExcircle&&this.excircle(t),t.showIncircle&&this.incircle(t),t.showRadius&&this.radius(e,t),(t.showVertices||t.identifierVertices)&&this.vertices(e,t),t.showCenter&&this.centerPoint(t),t.showDiagonal&&this.diagonal(e,t),t.fillInterval&&this.zebra(e,t),t.showMirror&&this.mirror(e,t),t.showAngle&&this.includedAngle(e,t)),this},closePath:function(t){var e=this.context;if(t){var r=!!_.isUndefined(t.closed)||t.closed;r&&e.closePath()}else e.closePath();return this},beginPath:function(t){var e=this.context;if(t){var r=!!_.isUndefined(t.begin)||t.begin;r&&e.beginPath()}else e.beginPath();return this},shadow:function(t){var e=this.canvas,r=this.context;return t||(t=this.opt&&this.opt.global?this.opt.global.background:"#000"),r.save(),this.setGlobalCompositeOperation(r,"source-over"),this.setGlobalAlpha(r,.18),this.setFillStyle(r,t),r.fillRect(0,0,e.width,e.height),r.restore(),this},clear:function(t){var e=this.canvas,r=this.context;return t?(this.setFillStyle(r,t||this.options.background||"#ffffff"),r.fillRect(0,0,e.width,e.height)):r.clearRect(0,0,e.width,e.height),this},central:function(){return{x:this.canvas.width/2,y:this.canvas.height/2}},"default":function(t){var e=this;return t?_.isArray(t)?t.map(function(t){return _.clone(e["default"](),t)}):_.clone(this["default"](),t):{x:this.canvas.width/2,y:this.canvas.height/2,r:10}},shortName:function(t){return t&&[{k:"n",v:"num"},{k:"s",v:"shape"},{k:"showA",v:"showAngle"},{k:"showR",v:"showRadius"},{k:"showV",v:"showVertices"},{k:"showC",v:"showCenter"},{k:"showEC",v:"showExcircle"},{k:"showIC",v:"showIncircle"},{k:"showD",v:"showDiagonal"},{k:"showM",v:"showMirror"}].forEach(function(e){_.isUndefined(t[e.k])||(t[e.v]=t[e.k])}),t},line:function(t,e,r){e&&t[r?"moveTo":"lineTo"](e.x,e.y)},link:function(t,e){var r=this,n=this.context,i=t.length;this.beginPath(e);var o=e&&e.dashed?e.dashLength:5;if(e&&e.dashed&&!n.setLineDash?t.forEach(function(e,a){var s=t[a+1===i?0:a+1],c=e.dist(s),h=e.split(s,c/o<<0);h.unshift(e),h.push(s),h.forEach(function(t,e){r.line(n,t,e%2===0)})}):(e&&n.setLineDash&&(e.dashed?n.setLineDash([o]):e.dashed===!1&&n.setLineDash([])),t.forEach(function(t,e){r.line(n,t,0===e)})),e&&e.curve){var a=_pointPolar({o:this.o});t.forEach(function(e,r){var o=t[r+1===i?0:r+1],s=a.toV(e),c=a.toV(o),h=s.add(c).toP(a);n.moveTo(e.x,e.y),n.quadraticCurveTo(h.x,h.y,o.x,o.y)})}return e&&e.semiarc&&t.forEach(function(e,r){var o=t[r+1===i?0:r+1],a=e.mid(o),s=a.toV(e),c=a.toV(o);n.moveTo(e.x,e.y),n.arc(a.x,a.y,s.abs(),s.rad(),c.rad(),!1)}),r.closePath(e),r.render(e,t),this},includedAngle:function(t,e){function r(r,o){var a=t[o+1===i?0:o+1],s=t[o-1===-1?i-1:o-1],c=r.toV(a),h=r.toV(s),u=Math.round(_.deg(c.ia(h)));n.arc(r,10,c.rad(),h.rad());var l=r.toV().abs(e.r+15).toP(r.o);return n.text({x:l.x,y:l.y,text:u+"°"})}var n=this,i=t.length;return"all"===e.showAngle?t.map(function(t,e){return r(t,e)}):r(t[0],0)},arc:function(t,e,r,n){var i=this.context;i.beginPath(),i.moveTo(t.x,t.y),i.arc(t.x,t.y,e,r,n,!1),this.fillstroke(this.opt)},excircle:function(t){return this.shape(_.clone(t,{shape:"circle",text:""}))},incircle:function(t){var e=t.r*_.cos(180/t.num);return this.shape(_.clone(t,{shape:"circle",r:e,text:""}))},escribedcircle:function(t){},radius:function(t,e){var r=this.context,n=e.x,i=e.y;r.beginPath(),t.forEach(function(t){r.moveTo(n,i),r.lineTo(t.x,t.y)}),this.fillstroke(e)},vertices:function(t,e){var r=this,n=_.color().rgb(),i=e.animate,o=e.animationInterval||200;t.forEach(function(t,a){t.fill=!0,e.identifierVertices?(t.r=10,t.text=a+1,t.color="rgba(0,0,0,0.2)"):(t.color=n,t.r=3),i?r.delay(function(){r.point(t)},o):r.point(t)})},centerPoint:function(t){return this.point({r:3,x:t.x,y:t.y,color:_.color().rgb(),fill:!0})},diagonal:function(t,e){for(var t=t||this.vertices(e),r=[],n=t.length,i=0;i<n-2;i++)for(var o=i+2;o<n;o++)0===i&&o===n-1||r.push([t[i],t[o]]);return this.linkGroup(r,_.clone(e,{showVertices:!1}))},zebra:function(t,e){var t=t||this.vertices(e),r=e.x,n=e.y,i=_.slice(t,2).map(function(t){return t.concat([{x:r,y:n}])});return this.linkGroup(i,_.clone(e,{fill:!0,showVertices:!1,showExcircle:!1,fillInterval:!1}))},mirror:function(t,e){var r=this,n=_.vertex(e),i=n.po;t.forEach(function(t,n){var o=i.mirror(t);r.shape(_.clone(e,{x:o.x,y:o.y,a:o.a+180,showMirror:!1}))})},linkGroup:function(t,e){var r=this;if(e&&e.animate){_.extend(e,{animate:!1});var n=e.animationInterval||0;t.forEach(function(t,i){r.delay(function(){r.link(t,e)},n)})}else t.forEach(function(t){r.link(t,e)});return r},text:function(t){return this.shape(_.clone({s:"text"},t))},point:function(t){return this.shape(_.clone({s:"circle",r:6,color:"rgba(0,0,0,0.2)",fill:!0},t))},shape:function(t){var e=this;if(_.isArray(t))return t.map(function(t){return e.shape(t)});if(t=e.shortName(t),t=e["default"](t),"random"===t.color&&(t.color=_.color().rgb()),e.save().set(t),t.animate&&t.easing&&_tween({start:{x:t.x,y:0,a:t.a-180},to:{x:t.x,y:t.y,a:t.a},duration:t.animationInterval||2e3,type:t.easing,callback:function(r){e.clear(),e.shape(_.clone(t,r,{easing:!1}))}}),t.delay)return e.delay(function(){e.shape(_.clone(t,{delay:!1}))},t.delay);var r=_.shape(e,t);return t.disappear&&this.disappear(t),e.restore(),r},group:function(t){var e;return t.group?(t.group=this.shortName(t.group),t.group=this["default"](t.group),
t.group.animate&&t.group.easing&&"none"!==t.group.easing?_tween({start:{r:t.group.r+100,a:t.group.a-180},to:{r:t.group.r,a:t.group.a},duration:t.group.animationInterval||2e3,type:t.group.easing,callback:function(r){_.extend(t.group,r,{easing:!1}),self.clear(),e=_shapeGroup(self,t)}}):e=_shapeGroup(this,t)):e=this.shape(t.shape),this.canvas.callback&&this.canvas.callback.call(this.context,this.context),e},motion:function(t){var e=this;t.motion=this.shortName(t.motion);var r=function(){e.mouse={x:e.canvas.width*Math.random(),y:e.canvas.height*Math.random()},e.mouseTimmer=setTimeout(r,t.motion.simulateInterval||1e3)};return e.mouseTimmer&&clearTimeout(e.mouseTimmer),t.motion.simulate&&r(),_motion(this,t)},global:function(t){if(!t||!t.global)return this;t.global.backgroundSize&&this.size({ratio:t.global.backgroundSize});var e=this.context;return this.setGlobalAlpha(e,t.global.alpha),t.global.compositeOperation&&this.setGlobalCompositeOperation(e,t.global.compositeOperation),t.global.showBackground&&t.global.background&&(this.setFillStyle(e,t.global.background),e.fillRect(0,0,this.width,this.height)),"none"!==t.global.movie?(this[t.global.movie](t.group||t.shape),!1):(this.id&&cancelAnimationFrame(this.id),t.global.showGrid&&("ecgGrid"===t.global.grid?this.ecgGrid(t.global):this.grid(t.global)),this)},setup:function(t){var e=this;return _.isArray(t)?t.map(function(t){return e.setup.call(e,t)}):(this.opt=t,this.motionCache&&this.motionCache.stop(),t.motion?this.motionCache=this.motion(t):this.global(t)?this.group(t):void 0)},stop:function(){this.motionCache&&this.motionCache.stop(),this.id&&cancelAnimationFrame(this.id),this.timmer&&clearTimeout(this.timmer)},verticesGroup:function(t){var e=this,r=e.vertices(t.group);return r.map(function(r){return e.vertices(_.clone(t.shape,{x:r.x,y:r.y}))})},translate:function(t,e,r){for(var t=this["default"](t),n=[],i=t.interval||10,o=t.step||1,a=t.direction||0,s=(t.x,t.y,_.pointPolar({o:{x:t.x,y:t.y}})),c=0;c<o;c++){var h=s.clone({r:i,a:a});n.push(h)}return n},origin:function(t){var e=this.context;return t?(e.translate(t.x,t.y),this):{x:0,y:0}},_grid:function(t,e){var r=this.context,n=this.width,i=this.height;r.strokeStyle=t,r.strokeWidth=1,r.beginPath();for(var o=.5;o<n;o+=e)r.moveTo(o,0),r.lineTo(o,i);for(var a=.5;a<i;a+=e)r.moveTo(0,a),r.lineTo(n,a);r.stroke()},grid:function(t){var e=t.background||t.color||_.color().rgb();self._grid(e,10)},ecgGrid:function(t){var e=this,r=_.color(),n=t.background||t.color||r.rgb(),i=r.light(n,.5),o=r.light(i,.5);[o,i,n].forEach(function(t,r){e._grid.call(e,t,3*Math.pow(5,r))})},dial:function(t){for(var e=t.r||50,r=[],n=[],i=_.pointPolar({r:e,a:0,o:{x:this.width/2,y:this.height/2}}),o=15,a=0,s=0;a<360;a+=2.8125,++s)s%4===0?r[r.length]=[i.clone({r:e-o,a:a}),i.clone({r:e,a:a})]:n[n.length]=[i.clone({r:e-o/2,a:a}),i.clone({r:e,a:a})];this.linkGroup(r,t),this.linkGroup(n,t)},reverse:function(){for(var t=this.canvas,e=this.context,r=e.getImageData(0,0,t.width,t.height),n=0;n<r.data.length;n+=4)r.data[n]=255-r.data[n],r.data[n+1]=255-r.data[n+1],r.data[n+2]=255-r.data[n+2],r.data[n+3]=255;e.putImageData(r,0,0)},getPixels:function(){var t=this.canvas,e=this.context,r=e.getImageData(0,0,t.width,t.height),n=100,i=100,o=r.width/n<<0,a=r.height/i<<0;console.log(r.data.length);for(var s=[],c=0;c<n;c++)for(var h=0;h<i;h++){var u=h*a*r.width+c*o,l=r.data[4*u],f=r.data[4*u+1],p=r.data[4*u+2],d=r.data[4*u+3],v=c*o,g=h*a,m="rgba("+[l,f,p,Math.round(10*d/255)/10]+")";if(d>10){var y=_.point({x:v,y:g,color:m,r:1});s.push(y)}}return s},disappear:function(t){var e,r=this,n=t.disappear||1e3,i=this.getPixels(),o=function(){r.clear(),i.forEach(function(t){r.point(t.move())}),e=setTimeout(o,17)};setTimeout(function(){o()},n),setTimeout(function(){r.clear(),e&&clearTimeout(e)},n+1e4)},track:function(t){_.track(this,t)},starrySky:function(t){function e(){r.shadow();var t=[],e=f.length;f.forEach(function(n,i){n.move(),r.point({x:n.x,y:n.y,r:n.r,color:n.color});for(var o=i+1;o<e;o++){var a=new d(n,f[o]);a.life&&(t[t.length]=a)}}),t.forEach(function(t){r.setLineWidth(o,2.5*t.alptha),r.setStrokeStyle(o,u.mix(t.a.color,t.b.color)),r.link([t.a,t.b])})}for(var r=this,n=this.width,i=this.height,o=this.context,a=t.num||10,s=t.maxNum||100,c=_.point({x:Math.random()*n,y:Math.random()*i,speed:t.speed||.5,height:i,width:n,color:"rgba(0,0,0,0.2)",r:1}),h=function(){return Math.random()>.9?3+3*Math.random():1+3*Math.random()},u=_.color(),l=u.circle(a),f=[];a--;)f[f.length]=c.clone({x:Math.random()*n,y:Math.random()*i,r:h(),color:l[a]});var p=t.lineMaxLength||_.min(n/4,200),d=(t.background||u.deepdark(),function(t,e){this.a=t,this.b=e,this.len=_.vector({x:t.x-e.x,y:t.y-e.y}).abs(),this.life=this.len<p,this.alptha=1-this.len/p});toucher([{el:r.canvas,callback:function(t,e){var r=_.pos(e);f[f.length]=c.clone({x:r.x,y:r.y,r:h(),color:u.rgb()}),f.length>=s&&f.shift()}},{el:r.canvas,type:"touchmove",callback:function(t,e){var r=_.pos(e),n=f[f.length-1];n.x=r.x,n.y=r.y}}]),r.loop(function(){e(),render()})},firework:function(t){function e(){a.forEach(function(t,e){if(t.move().reborn){for(var r=20;r--;)s[s.length]=new p(t,u[e]);t.reset()}});for(var t=s.length-1;t>=0;t--){var e=s[t];e&&e.move().die&&s.splice(t,1)}}function r(){n.shadow(),n.setGlobalCompositeOperation(i,"screen"),n.setGlobalAlpha(i,1),a.forEach(function(t){n.point({x:t.x,y:t.y,r:t.r,color:t.color})}),s.forEach(function(t){n.setGlobalAlpha(i,t.alpha),n.point({x:t.x,y:t.y,r:t.r,color:t.color})})}t=t||{};var n=this,i=this.context,o=(this.width,this.height),a=[],s=[],c=t.num||5,h=100,u=_.color().circle(c),l=this.o,f=function(){this.x=Math.random()*h/2-h/4+l.x,this.y=Math.random()*h*2+o,this.r=Math.random()+.5,this.color="#fd1",this.vx=Math.random()-.5,this.vy=-(Math.random()+4),this.ax=.02*Math.random()-.01,this.far=Math.random()*h+(l.y-h),this.base={x:this.x,y:this.y,vx:this.vx}};f.prototype.reset=function(){this.y=this.base.y,this.x=this.base.x,this.vx=this.base.vx,this.ax=.02*Math.random()-.01,this.reborn=!1},f.prototype.move=function(){return this.x+=this.vx,this.y+=this.vy,this.vx+=this.ax,this.y<=this.far&&(this.reborn=!0),this};var p=function(t,e){this.x=t.x,this.y=t.y,this.r=Math.random()+1.5,this.color=e,this.vx=5*Math.random()-2.5,this.vy=Math.random()*-5+1.5,this.ay=.05,this.alpha=1,this.life=Math.round(Math.random()*h/2)+h/2,this.base={life:this.life,r:this.r}};p.prototype.move=function(){return this.x+=this.vx,this.y+=this.vy,this.vy+=this.ay,this.alpha=this.life/this.base.life,this.r=this.alpha*this.base.r,this.alpha=this.alpha>.6?1:this.alpha,this.life--,this.life<=0&&(this.die=!0),this};for(var d=0;d<c;d++)a[a.length]=new f;n.loop(function(){e(),r()})},rain:function(t){function e(t,e,r){for(var n=Math.floor(5*Math.random()+5),i=0;i<n;i++)p[p.length]=new h(t,e,r)}function r(){p.forEach(function(t){t.move()});for(var t=p.length-1;t>=0;t--)p[t]&&p[t].die&&p.splice(t,1);l+=(f-l)/50,v.length<=50&&(v[v.length]=new c(2*Math.random()*a-.5*a));var r=s-Math.random()*s/5;v.forEach(function(t){t.y+t.h>r&&Math.random()>.75&&(e(t.x+l*t.h,t.y+t.h,t.color),t.die=!0),t.y>=s?t.die=!0:(t.y+=t.speed,t.x+=t.speed*l)});for(var t=v.length-1;t>=0;t--)v[t]&&v[t].die&&v.splice(t,1)}function n(){i.shadow(),v.forEach(function(t){o.strokeStyle=t.color,o.lineWidth=3,o.beginPath(),o.moveTo(t.x,t.y),o.lineTo(t.x+l*t.h,t.y+t.h),o.stroke()}),p.forEach(function(t){o.lineWidth=1,o.strokeStyle=t.color,o.beginPath(),o.arc(t.x,t.y,t.r,Math.random()*Math.PI*2,1*Math.PI),o.stroke()})}t=t||{};var i=this,o=this.context,a=this.width,s=this.height,c=function(t){var e=.25*(50+100*Math.random());this.speed=2*(6*Math.random()+3),this.die=!1,this.x=t,this.y=-200,this.h=e,this.color=_.color().rgba(0,0,0)},h=function(t,e,r){this.die=!1,this.x=t,this.y=e,this.vx=8*(Math.random()-.5),this.vy=Math.random()*-6-3,this.r=1.5*Math.random()+1,this.color=r},u=.5,l=0,f=0;h.prototype.move=function(){this.vx=this.vx+l/2,this.x=this.x+this.vx,this.vy=this.vy+u,this.y=this.y+this.vy,this.y>s&&(this.die=!0)};var p=[],d=[0,0],v=[];i.loop(function(){r(),n()}),toucher({el:i.canvas,type:"touchmove",callback:function(t){d[0]=t.clientX,d[1]=t.clientY,f=(t.clientX-a/2)/(a/2)}})},vertexTransform:function(t){function e(){var e=_.vertex(t).vs;return e.map(function(t){return _.extend(t,{vx:(2*Math.random()-1)*i,vy:(2*Math.random()-1)*i})})}function r(){n.shadow(),s.forEach(function(t,e){t.x+=t.vx,t.y+=t.vy,t.x<0||t.x>c?t.vx=-t.vx:(t.y<0||t.y>h)&&(t.vy=-t.vy),t1=s[e+1==p?0:e+1];var r=new l(t,t1);f[f.length]=r,f.length>p&&f.shift(),r.alptha<=0&&(t.vx=-t.vx,t.vy=-t.vy)}),o.beginPath(),s.forEach(function(t,e){var r=s[e+1===p?0:e+1],n=d.toV(t),i=d.toV(r),a=n.add(i).toP(d);o.moveTo(t.x,t.y),o.quadraticCurveTo(a.x,a.y,r.x,r.y)}),o.stroke()}var n=this,i=1,o=this.context;t=this["default"](t);var a=_.color().rgb();n.setStrokeStyle(o,a);var s=e(),c=this.width,h=this.height,u=t.lineMaxLength||_.min(c/4,200),l=function(t,e){this.a=t,this.b=e,this.len=_.vector({x:t.x-e.x,y:t.y-e.y}).abs(),this.life=this.len<u,this.alptha=1-this.len/u},f=[],p=s.length,d=_.vertex(t).po;n.loop(r)},vertexRotate:function(t){function e(){r.shadow(),i=i.map(function(t,e){return t.rotate(e*o)}),r.link(i)}var r=this,n=this.context;t=this["default"](t);var i=_.vertex(t).vs,o=(t.num||10,1),a=_.color().rgb();r.setStrokeStyle(n,a),r.loop(e)},loop:function(t,e){var r=this;r.stop(),e?!function n(){r.timmer=setTimeout(n,e),t&&t()}():!function i(){r.id=requestAnimationFrame(i),t&&t()}()},spiral:function(t){var e=this,r=e.context,n=e.width,i=e.height,o=_.color().circle(361);t=t||{};var a=t.interval||1,s=t.step||1,c=function(t,a){var c=_.pointPolar({o:e.o}),h=[c],u=0;do{var l=c.toV().rotate(a);if(u%s===0){var f=l.abs();l=l.abs(f+t)}c=l.toP(c),h[h.length]=c,u++}while(c.x>0&&c.x<n&&c.y>0&&c.y<i);r.beginPath(),h.forEach(function(t,n){e.line(r,t,0==n)}),r.lineWidth=1,r.strokeStyle=o[a],r.stroke()},h=360,u=this.slider({max:h,callback:function(t){l(t)}}),l=function(t){e.clear(),c(a,t),u.render(t,o[t])},f=0;e.loop(function(){u.pasue||(l(f++),f%=h)},200)},slider:function(t){return _slider(this,t)}},_draw.prototype.init.prototype=_draw.prototype;var createOptCycle=_.createOptCycle=function(t){var e={data:{},methods:{autoNext:function(t,r){if(inBrowser){var n=t.closest(".tab-body-item").attr("name"),i=t.name,o=t.checked;e.data[n][i].auto=o,console.log(i,o)}}},filters:{toggle:function(t){return t===!0?"是":"否"},color:function(t){return inBrowser?t+'<div class="colorblock" style="background-color:'+t+'"></div>':t}}};for(var r in t){var n=t[r];if(_.isObject(n)){e.data[r]={};for(var i in n){var o=n[i];if("switch"===i)e.data[r][i]=o;else{var a=o.type,s=null;switch(a){case"picker":case"picker_multi":s=_.cycle(o.values,o.index||0);break;case"slider":s=_.sliderCycle(o);break;case"color":case"color_rgba":case"color_rgb":var c=o.length||15,h=["#000","#fff"].concat(_color().circle(c));s=_.cycle(h,0);break;case void 0:_.isBoolean(o)?(s=_.cycle([{key:!0,text:"是"},{key:!1,text:"否"}],o?0:1),s.type="toggle",s.value=o):_.isObject(o)?_.isBoolean(o.value)&&(s=_.cycle([{key:!0,text:"是"},{key:!1,text:"否"}],o.value?0:1),s.type="toggle",s.value=o.value):_.isString(o)&&(e.data[r][i]=o)}s&&(o.text&&(s.text=o.text),o.auto&&(s.auto=o.auto),o.type&&(s.type=o.type),e.data[r][i]=s)}}}}return e.init=function(){var t={};for(var r in e.data){var n=e.data[r];if(_.isObject(n)){if(~["group","motion"].indexOf(r)&&"off"===n["switch"])continue;t[r]={};for(var i in n){var o=n[i];_.isBoolean(o)?t[r][i]=o:_.isObject(o)?_.isBoolean(o.value)?(t[r][i]=o.value,o.auto&&(o.value=!o.value)):(t[r][i]=_.isObject(o.val())?o.val().key:o.val(),o.auto&&o.next&&o.next()):_.isString(o)&&(t[r][i]=o)}}}return t},e.viewData=function(){var t=e.data,r={tabs:[]};for(var n in t){var i={key:n,items:[],"switch":"none",active:!1};r.tabs.push(i);var o=t[n];if(_.isObject(o))for(var a in o){var s=o[a];if("text"===a)i[a]=s;else if("switch"===a)i[a]=s,i[a+"Method"]=_.camelCase("next",n,a);else if("active"===a)i[a]=s;else{var c={key:a,value:s,text:a,id:n+"_"+a};_.isBoolean(s)?(c.filter="toggle",c.value=e.filters.toggle(s)):_.isNumber(s)?c.filter="string":_.isObject(s)?(c=_.extendOwn(c,s),_.isBoolean(s.value)?c.value=e.filters.toggle(s.value):_.isObject(s.val())?c.value="text"in s.val()?s.val().text:s.val():~["color","lineColor","background","shadowColor"].indexOf(c.key)?c.value=e.filters.color(s.val()):c.value=s.val()):c.filter=a,i.items[i.items.length]=c}}}return r},e.setVal=function(t,r){return _.setVal(e.data,t,r)},e.getVal=function(t){return _.getVal(e.data,t)},e},tasker=_.tasker=function(t){return new tasker.prototype.init(t)};tasker.prototype={constructor:tasker,init:function(t){var e=t.file,r=(this.data=t.data,t.callback);"undefined"!=typeof Worker&&("undefined"==typeof this.w&&(this.w=new Worker(e)),this.w.addEventListener("message",function(t){console.log(t.data),r&&r(t.data)}))},open:function(t,e){return this.w.postMessage({name:t,act:"open",cfg:_.clone(this.data,e)}),console.log("task open: "+t),this},close:function(t){return this.w.postMessage({name:t,act:"close"}),console.log("task close: "+t),this}},tasker.prototype.init.prototype=tasker.prototype;var scroller=_.scroller=function(t){return new scroller.prototype.init(t)};scroller.prototype={constructor:scroller,init:function(t){var e=this;if(t){var r=function(){toucher({el:e.el,type:"scroll",callback:function(){e.onScroll&&e.onScroll.call(e.el)}})};e.root=document.body,_.isObject(t)?(e.el=t.el?_.query(t.el):e.root,e.onTop=t.onTop,e.onBottom=t.onBottom,e.onScroll=t.onScroll):_.isString(t)?e.el=_.query(t):_.isFunction(t)&&(e.el=e.root,e.onScroll=t),e.onScroll&&r()}else e.el=e.root;e.isRoot=!!~["HTMLHtmlElement","HTMLBodyElement","htmldocument"].map(function(t){return t.toLowerCase()}).indexOf(_.type(e.el)),e.isRoot?e.scrollTop=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0:e.scrollTop=e.el.scrollTop},toView:function(t){t=_.query(t)||this.el,t.scrollIntoView()},atTop:function(){return 0===this.el.scrollTop},atBottom:function(){return this.isRoot?this.el.scrollTop+this.el.clientHeight===this.el.offsetHeight:this.el.scrollTop+this.el.clientHeight===this.el.scrollHeight},toTop:function(t){this.el.scrollTop=0,t&&t.call(this.el)},toBottom:function(t){this.el.scrollTop=this.el.scrollHeight,t&&t.call(this.el)},scrollpage:function(t,e){var r=this,n=e||10;switch(r.timer&&clearTimeout(r.timer),r.srollerTimer&&clearTimeout(r.srollerTimer),t){case"up":r.el.scrollTop-=n;break;case"down":r.el.scrollTop+=n}e||(r.timer=setTimeout(function(){r.scrollpage.call(r,t)},17))},to:function(t,e){window.scrollTo(t,e)},up:function(t){this.scrollpage.call(this,"up",t)},down:function(t){this.scrollpage.call(this,"down",t)},stop:function(){this.timer&&clearTimeout(this.timer)}},scroller.prototype.init.prototype=scroller.prototype;var router=_.router=function(t){return new router.prototype.init(t)};router.prototype={constructor:router,pageStack:[],configs:[],pageAppend:function(){},defaultPage:null,pageIndex:1,routes:{},defaultAction:"home",init:function(t){var e=this;t&&(this.routes=t),addEvent("hashchange",window,function(){var t=e.parseUrl();e._go(t.route)}),history.state&&history.state.pageIndex&&(this.pageIndex=history.state.pageIndex),this.pageIndex--;var r=0===location.hash.indexOf("#")?location.hash:"#",n=e._find("url",r)||e.defaultPage;this._go(n)},getAction:function(t){return this.routes[t]?this.routes[t]:this.defaultAction},getSearch:function(){var t=location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(){var t=location.href.match(/#(.*)$/);return t?t[1]:""},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getPath:function(){var t=this.decodeFragment(location.pathname+this.getSearch()).slice(0);return"/"===t.charAt(0)?t.slice(1):t},parseUrl:function(){var t={},e=location.href,r=location.hash,n=r,i=function(){var t=location.href.match(/#(.*)$/);return t?t[1]:""},o=this.getPath();return r=i(),e.replace(/[?&](.+?)=([^&#]*)/g,function(_,e,r){t[e]=decodeURI(r)}),r&&(r=r.length>1?r.replace(/#+/g,"#"):"",n=r.replace(/#/g,"")),{params:t,hash:r,route:n,path:o}},push:function(t){return this.configs.push(t),this},go:function(t){t&&(location.hash=t)},_go:function(t){this.pageIndex++,history.replaceState&&history.replaceState({pageIndex:this.pageIndex},"",location.href);var e=this.getAction(t);_.isFunction(e)?e.call(this):console.log(e),console.log(this.pageIndex)},back:function(){history.back()},_back:function(t){this.pageIndex--;var e=this.pageStack.pop();if(e){var r=0===location.hash.indexOf("#")?location.hash:"#",n=this._findInStack(r);if(!n){var i=_.$(t.template).addClass("js_show").addClass(t.name);i.insertBefore(e.dom),t.isBind||this._bind(t),this.pageStack.push({config:t,dom:i})}return this}},_findInStack:function(t){for(var e=null,r=0,n=this.pageStack.length;r<n;r++){var i=this.pageStack[r];if(i.config.url===t){e=i;break}}return e},_find:function(t,e){for(var r=null,n=0,i=this.configs.length;n<i;n++)if(this.configs[n][t]===e){r=this.configs[n];break}if(!r){var r={template:e,id:e,url:e};r[t]=e,this.push(r)}return r},_bind:function(t){var e=t.events||{};for(var r in e)for(var n in e[r]);t.isBind=!0}},router.prototype.init.prototype=router.prototype;var StandardFilters={string:function(t){return(_.isArray(t)||_.isObject(t))&&(t=_.stringify(t)),t},first:function(t){return _.isArray(t)&&(t=t[0]),t},last:function(t){return _.isArray(t)&&(t=t[t.length-1]),t},pre:function(t){return _.preHtml(t)},"int":function(t){return _.isNumber(+t)?Math.round(+t):t},number:function(t){return+t},wan:function(t){return+t>1e4?(+t/1e4).toFixed(1)+"万":t},fixed:function(t){return(+t).toFixed(1)},cent:function(t){return(+t/100).toFixed(2)},percent:function(t){return Math.ceil(100*t)+"%"},yearmonth:function(t){return new Date((+t)).format("YYYY年MM月")},monthdaytime:function(t){return new Date((+t)).format("MM月DD日 HH:mm")},datetime:function(t){return new Date((+t)).format("YYYY-MM-DD HH:mm")},date:function(t){return new Date((+t)).format("YYYY-MM-DD")},time:function(t){return new Date((+t)).format("HH:mm")},avatar:function(t){return t?' style="background-image: url('+t+');"':""},file:function(t){return"<div data-file='"+t+"'></div>"},text:function(t){return _.escape(t)}};["markdown","escape","unescape"].forEach(function(t){StandardFilters[t]=function(e){return _[t](e)}}),["round","ceil","floor"].forEach(function(t){StandardFilters[t]=function(e){return _.isNumber(+e)?Math[t](+e):e}});var callFilter=function(t,e,r){if(e){var n=this,i=function(t,e,r){var i=customFilters[e];if(_.isUndefined(i))return t;if(_.isFunction(i))t=i.call(n,t,r);else try{var o=new Function("return ("+i+".call(this,arguments[0]));");t=o.call(n,t,r)}catch(a){console.log(a);try{var o=new Function("data","return ("+i+");");t=o.call(n,t,r)}catch(a){console.log(a),t=i}}return t},o=(""+e).split(","),a=o.length;a>0&&"string"!==o[a-1]&&o.push("string"),o.forEach(function(e){t=i.call(n,t,e,r)})}return t},regModel=/<[^>]+?model=\"(.*?)\".*?(>.*?<)\/[^>]+?>/gi,regbind=/<[^>]+?bind=\"(.*?)\".*?(>.*?<)\/[^>]+?>/gi,preModel=function(t){var e=new RegExp([regModel.source,regbind.source].join("|")+"|$","gi");return t.replace(e,function(t,e,r,n,i){return e=e||n,r=r||i,t.replace(r,">{="+e+"}<")})},parseTag=_.parseTag=function(t,e){var r=this;return t.replace(reg_tpl_tag,function(t,n,i){n=n.trim(),i=(i||"string").trim();var o="";try{if(0===i.indexOf("$")&&(i=e[i.substr(1)]),"$index"===n.toLowerCase())return $index++;if("$length"===n.toLowerCase())return $length;o="$this"===n.toLowerCase()?e:reg_operation_symbol.test(n)?e.cmd(n):_.getVal(e,n)}catch(a){console.log(a,e)}return _.isUndefined(o)&&(o=""),o=callFilter.call(r,o,i,e)})},parseTpl=_.parseTpl=function(t){var e=t||this,r=e.tpl||getTpl(e.template),n=e.groupTpl,i=e.lazyTpl,o=e.moreTpl,a=e.defaultTpl,s=e.loop,c=e.syntax,h=e.data;if(_.isEmpty(r)&&_.isEmpty(n))return"";r&&(r=preModel(r)),$index=1;var u="";if(_.isUndefined(h))l=0,u=_.isUndefined(a)?r:a;else if(_.isArray(h)){var l=h.length,f=Number(s)||l;(o||i)&&f>=l&&(f=3);for(var p=[],d="",v="",g=0;g<l;g++){var m=h[g];if(_.isUndefined(n)||(v=parseTag.call(e,n,m),v!==d&&p.push(v),d=v),g>=f){if(!_.isUndefined(o)){p.push(parseTag.call(e,o,m));break}if(_.isUndefined(i))break;p.push(parseTag.call(e,i,m))}else r&&p.push(parseTag.call(e,r,m))}u=p.join("")}else _.isObject(h)?(l=1,r&&(u=parseTag.call(e,r,h))):(l=1,u=r);var c=c||customSyntax,y={markdown:_.markdown,pre:_.preHtml};return c in y?y[c](u):u},getTpl=_.getTpl=function(t){if(t){var e=_.query(t.pound());return e&&e.length>0?_.text(e).trim():null}return null},elTpl=function(t){var e,r;return _.hasAttr.call(this,t)&&(r=this.attr(t),e="this"===r||_.isEmpty(r)?_.html(this).trim():getTpl(r)),e},parseEl=function(){var t,e,r,n=this,i=n.el,o=n.data,a=n.act,s=n.keyword;if(n.tpl=n.template||elTpl.call(i,TEMPLATE),[GROUP,LAZY,MORE,DEFAULT].forEach(function(t){n.templates&&!_.isUndefined(n.templates[t])?n[t+"Tpl"]=n.templates[t]:n[t+"Tpl"]=elTpl.call(i,t)}),n.tpl)r="auto";else if(n.groupTpl);else if(t=i.html(),r="1",!reg_tpl_tag.test(t))return parseDirective.call(n,i,o),!1;if(_.hasAttr.call(i,SYNTAX)&&(e=i.attr(SYNTAX)),_.hasAttr.call(i,NOLOOP)&&(r="1"),_.hasAttr.call(i,LOOP)&&(r=i.attr(LOOP)),_.hasAttr.call(i,PAGESIZE)&&(r=i.attr(PAGESIZE)),_.hasAttr.call(i,DATA)){var c=i.attr(DATA);_.has(o,c)&&(o=o[c])}if(_.isArray(o)&&s&&_.hasAttr.call(i,KEYWORD)){var h=i.attr(KEYWORD);o=_.filter(o,function(t){var e=h.split(",");if(1===e.length)return _.has(_.getVal(t,h),s);var r=!1;return e.forEach(function(e){_.has(_.getVal(t,e),s)&&(r=!0)}),r})}$length=_.isArray(o)?o.length:_.isUndefined(o)?0:(_.isObject(o),1);var u=_.clone(n,{data:o,loop:r,syntax:e}),l=parseTpl.call(u);switch(a){case"append":l=i.html()+l;break;case"before":l+=i.html()}(n.tpl||i.attr(TEMPLATE)||i.attr(GROUP))&&i.html(l),parseDirective.call(n,i,o)},StandardDirectives={},parseDirective=function(t,e){var r=this,n=t.query(MODEL.brackets()),i=function(t,e){if(_.isElement(this)){var n=this.attr(ON),i=r.methods[n];i&&_.isFunction(i)&&i.call(r,this,e)}};StandardDirectives[ON]=i;var o;_.each(StandardDirectives,function(e,n){o=n===DRAG?DRAG:TAP;var i=_.$(n.brackets(t));if(ON!==n){var a=function(t,e){var i=r.methods["_on_"+n];i&&_.isFunction(i)&&i.call(r,t,e)};toucher({el:i,type:o,clear:!0,listener:a})}else toucher({el:i,type:o,clear:!0,listener:e})}),n&&n.length>0&&n.each(function(t,e){var r=this.attr(MODEL),n=_.query(this).val();template.prototype[r]=n;var i=_.clone(template.prototype);Object.defineProperty(template.prototype,r,{set:function(t){var e=i[r];i[r]=t,t!==e&&template.prototype.apply(r,t)},get:function(){return i[r]},enumerable:!0,configurable:!0})}),n&&n.length>0&&n.on("keyup",function(){var e=_.query(this).val(),r=this.attr(MODEL);t.query(MODEL.brackets()).html(e),console.log(e,r),template.prototype[r]=e})};return template.prototype={constructor:template,init:function(t){var e=this,r=arguments.length;switch(e.methods={},r){case 0:if(_.isEmpty(e.el))return;break;case 1:if(_.isArray(t))return t.map(function(t){return template(t)});_.isObject(t)&&_.each(t,function(r,n){switch(n){case"el":if(e.el=t.el,_.isString(e.el)&&(e.el=_.query(e.selector=e.el)),_.isJQuery(e.el)&&(e.el=_.jqToEl(e.el,_.autoid)),!(_.isElement(e.el)||_.isArray(e.el)&&_.size(e.el)>0))return console.log("not query el"+t.el),e.el=document.createElement("div"),e.el.id=t.el.replace("#",""),t.template&&e.el.setAttribute("template",t.template.replace("#","")),t.container?_.query(t.container).appendChild(e.el):document.body.appendChild(e.el),!1;rootEl=e.el;break;case"data":e.data=_.isFunction(t.data)?t.data():t.data,_.isObject(e.data)||_.isArray(e.data)||(e.data={});break;case"syntax":e.syntax=customSyntax=t.syntax;break;case"methods":e.methods=_.clone(customMethods,r);break;default:e[n]=r}});break;default:throw new Error("invalid options ,formate should be likes: {el:el,data:data}")}customFilters=_.clone(StandardFilters,e.filters),_.extend(StandardDirectives,e.directives),_.each(e.directives,function(t,r){e.methods["_on_"+r]=t}),t=_.extend(t,{el:e.el,methods:e.methods}),_.isFunction(e.before)&&e.before.call(e,e.data);var n=e.el;if("cloneBefore"===e.act){var i=_.autoid(e.el.cloneNode(!0),!0);e.el.parentNode.insertBefore(i,e.el),t.act="",n=t.el=i}if("cloneAfter"===e.act){var i=_.autoid(e.el.cloneNode(!0),!0);e.el.parentNode.appendChild(i,e.el),t.act="",n=t.el=i}if(_.isElement(n)?e.parser.call(t,n):_.isArray(n)&&_.size(n)>0&&n.forEach(function(r){e.parser.call(_.clone(t,{el:r}),r)}),_.isFunction(e.callback)&&e.callback.call(t,e.data),e.events)if(_.isFunction(e.events))toucher({el:n,type:"tap",clear:!0,listener:e.events});else if(_.isObject(e.events)){var o=[];for(x in e.events)o.push({el:n,type:x,listener:e.events[x]});toucher(o)}},parser:function(t){var e=this;if(e.template||_.hasAttr.call(t,TEMPLATE)||_.hasAttr.call(t,GROUP))parseEl.call(e);else{var r=t.query(TEMPLATE.brackets(),GROUP.brackets());_.size(r)>0&&r.each(function(t,r){parseEl.call(_.clone(e,{el:t}))})}},apply:function(t,e){var r=function(t,e){return t+"='"+e+"'"},n=[];n.push(r(MODEL,t).brackets()),n.push(r(BIND,t).brackets());var i=""+n;rootEl.query(i).each(function(t,r){switch(console.log(this.tagName,t),this.tagName.toLowerCase()){case"div":_.query(this).html(e);break;case"input":_.query(this).val(e)}})}},_.extend(template.prototype,_),template.prototype.init.prototype=template.prototype,inBrowser&&(window._||(window._=_),window.tpler=_.tpler,window.toucher=_.toucher,window.walker=_.walker,window.router=_.router),template});